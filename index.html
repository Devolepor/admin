<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #0288d1;
      --primary-dark: #01579b;
      --danger-color: #d32f2f;
      --warning-color: #f57c00;
      --success-color: #388e3c;
      --text-color: #263238;
      --text-light: #546e7a;
      --light-bg: #eceff1;
      --white: #ffffff;
      --gray-light: #cfd8dc;
      --gray-dark: #b0bec5;
      --shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
      --radius: 16px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .dark-mode {
      --primary-color: #4fc3f7;
      --primary-dark: #0288d1;
      --danger-color: #ef5350;
      --warning-color: #ff9800;
      --success-color: #66bb6a;
      --text-color: #eceff1;
      --text-light: #b0bec5;
      --light-bg: #263238;
      --white: #37474f;
      --gray-light: #546e7a;
      --gray-dark: #455a64;
      --shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Tajawal', sans-serif;
      background: linear-gradient(135deg, var(--light-bg), #ffffff);
      color: var(--text-color);
      line-height: 1.6;
      padding: 0;
      margin: 0;
      min-height: 100vh;
      transition: var(--transition);
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 30px;
    }

    .sidebar {
      position: fixed;
      right: -100%;
      top: 0;
      width: 320px;
      height: 100%;
      background: var(--white);
      box-shadow: var(--shadow);
      transition: var(--transition);
      z-index: 1000;
      overflow-y: auto;
      padding: 20px;
      border-radius: 0 0 0 16px;
    }

    .sidebar.open {
      right: 0;
    }

    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--gray-light);
    }

    .sidebar-title {
      font-size: 22px;
      font-weight: 700;
      color: var(--primary-color);
    }

    .sidebar-menu a {
      display: flex;
      align-items: center;
      padding: 15px;
      border-radius: var(--radius);
      color: var(--text-color);
      text-decoration: none;
      transition: var(--transition);
      font-weight: 500;
      background: linear-gradient(90deg, var(--light-bg), var(--white));
      margin-bottom: 10px;
    }

    .sidebar-menu a:hover {
      background: var(--primary-color);
      color: var(--white);
      transform: translateX(-8px);
      box-shadow: var(--shadow);
    }

    .sidebar-toggle {
      position: fixed;
      right: 30px;
      top: 30px;
      background: var(--primary-color);
      color: var(--white);
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1001;
      box-shadow: var(--shadow);
      font-size: 24px;
    }

    .header {
      background: var(--white);
      padding: 20px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      color: var(--primary-color);
      font-size: 28px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .btn {
      background: var(--primary-color);
      color: var(--white);
      border: none;
      font-weight: 600;
      cursor: pointer;
      padding: 12px 24px;
      border-radius: 8px;
      transition: var(--transition);
      box-shadow: var(--shadow);
    }

    .btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1050;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      overflow-y: auto;
      animation: fadeIn 0.3s ease;
    }

    .modal-content {
      background: var(--white);
      padding: 30px;
      border-radius: var(--radius);
      width: 90%;
      max-width: 700px;
      margin: 40px auto;
      box-shadow: var(--shadow);
      animation: slideIn 0.3s ease;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-title {
      color: var(--primary-color);
      font-size: 24px;
      font-weight: 700;
    }

    .close {
      color: var(--text-light);
      font-size: 28px;
      cursor: pointer;
      transition: var(--transition);
    }

    .close:hover {
      color: var(--danger-color);
      transform: scale(1.2);
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--primary-color);
    }

    input, select, textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--gray-light);
      border-radius: 8px;
      font-size: 16px;
      transition: var(--transition);
    }

    input:focus, select:focus, textarea:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(2, 136, 209, 0.2);
      outline: none;
    }

    .image-upload-container {
      background: var(--light-bg);
      padding: 20px;
      border-radius: 12px;
      text-align: center;
    }

    .image-preview {
      width: 150px;
      height: 150px;
      object-fit: cover;
      border-radius: 12px;
      border: 2px dashed var(--gray-light);
      cursor: pointer;
      transition: var(--transition);
    }

    .student-card {
      background: var(--white);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      transition: var(--transition);
    }

    .student-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
    }

    .qr-code-container {
      text-align: center;
      margin: 20px 0;
      padding: 15px;
      background: var(--light-bg);
      border-radius: 12px;
    }

    .stats-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(145deg, var(--white), var(--light-bg));
      border-radius: var(--radius);
      padding: 25px;
      box-shadow: var(--shadow);
      text-align: center;
      transition: var(--transition);
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
    }

    .stat-card .value {
      font-size: 32px;
      font-weight: 700;
      color: var(--primary-color);
      margin: 15px 0;
    }

    .report-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: var(--white);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .report-table th, .report-table td {
      padding: 12px;
      text-align: center;
      border: 1px solid var(--gray-light);
    }

    .report-table th {
      background: var(--primary-color);
      color: var(--white);
      font-weight: 600;
    }

    .report-table tbody tr:hover {
      background: var(--light-bg);
    }

    .report-filter {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .report-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    @media (min-width: 768px) {
      .modal-content {
        width: 80%;
        max-width: 800px;
      }
    }

    @media (max-width: 480px) {
      .container {
        padding: 15px;
      }

      .sidebar {
        width: 100%;
      }
    }

    .login-screen {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: var(--light-bg);
    }

    .login-box {
      background: var(--white);
      padding: 30px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      text-align: center;
      width: 100%;
      max-width: 400px;
    }

    .login-box h2 {
      color: var(--primary-color);
      margin-bottom: 20px;
    }

    .login-box input {
      margin-bottom: 15px;
    }

    .btn-success {
      background: var(--success-color);
    }

    .btn-success:hover {
      background: #2e7d32;
    }

    .btn-danger {
      background: var(--danger-color);
    }

    .btn-danger:hover {
      background: #b71c1c;
    }

    .btn-secondary {
      background: var(--gray-dark);
    }

    .btn-secondary:hover {
      background: #90a4ae;
    }

    .file-info {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      background: var(--white);
      padding: 15px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .control-panel {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .btn-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .tab {
      padding: 12px 20px;
      background: var(--gray-light);
      color: var(--text-color);
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
    }

    .tab.active {
      background: var(--primary-color);
      color: var(--white);
    }

    .tab:hover {
      background: var(--primary-dark);
      color: var(--white);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .posts-container {
      background: var(--white);
      padding: 20px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .posts-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .post {
      background: var(--white);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
      position: relative;
    }

    .post-header {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    .post-avatar {
      width: 40px;
      height: 40px;
      background: var(--primary-color);
      color: var(--white);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .post-author {
      font-weight: 600;
    }

    .post-date {
      color: var(--text-light);
      font-size: 14px;
    }

    .post-content {
      margin-bottom: 15px;
    }

    .post-image {
      max-width: 100%;
      border-radius: 12px;
      margin-top: 10px;
      cursor: pointer;
    }

    .post-actions {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .post-action {
      cursor: pointer;
      color: var(--text-light);
      transition: var(--transition);
    }

    .post-action:hover {
      color: var(--primary-color);
    }

    .post-action.liked {
      color: var(--danger-color);
    }

    .post-delete {
      position: absolute;
      top: 10px;
      left: 10px;
      color: var(--danger-color);
      cursor: pointer;
      font-size: 18px;
      transition: var(--transition);
    }

    .post-delete:hover {
      transform: scale(1.2);
    }

    .student-image-thumb {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      margin-left: 10px;
    }

    .edit-student-btn {
      position: absolute;
      top: 10px;
      left: 10px;
      color: var(--primary-color);
      cursor: pointer;
      font-size: 18px;
      transition: var(--transition);
    }

    .edit-student-btn:hover {
      transform: scale(1.2);
    }

    .student-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }

    .student-name {
      font-weight: 600;
      font-size: 18px;
    }

    .student-id {
      color: var(--text-light);
      font-size: 14px;
    }

    .student-grade {
      background: var(--primary-color);
      color: var(--white);
      padding: 5px 10px;
      border-radius: 8px;
    }

    .student-level {
      color: var(--text-light);
      font-size: 14px;
    }

    .student-detail-card {
      background: var(--white);
      padding: 20px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .student-detail-header {
      margin-bottom: 20px;
    }

    .student-info-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      padding: 10px;
      background: var(--light-bg);
      border-radius: 8px;
    }

    .student-info-label {
      font-weight: 600;
      color: var(--primary-color);
    }

    .student-info-value {
      color: var(--text-color);
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    .fees-grid, .attendance-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-bottom: 20px;
    }

    .fee-item, .attendance-item {
      background: var(--light-bg);
      padding: 10px;
      border-radius: 8px;
      text-align: center;
    }

    .fee-item span, .attendance-item span {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
    }

    .no-students {
      text-align: center;
      padding: 20px;
      background: var(--white);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .share-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .theme-toggle i.fa-moon::before {
      content: "\f185";
    }

    .theme-toggle.active i.fa-moon::before {
      content: "\f186";
    }

    .spinner {
      border: 4px solid var(--white);
      border-top: 4px solid var(--primary-dark);
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
      vertical-align: middle;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideIn {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
  </style>
</head>
<body>
  <div id="imageModal" class="modal image-modal">
    <span class="close-image" onclick="closeImageModal()">Ã—</span>
    <div class="modal-content">
      <img class="image-modal-content" id="expandedImage">
    </div>
  </div>

  <div class="login-screen" id="loginScreen">
    <div class="login-box">
      <h2><i class="fas fa-lock"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
      <input type="password" id="loginPassword" placeholder="Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
      <button class="btn btn-success" onclick="checkLogin()"><i class="fas fa-sign-in-alt"></i> Ø¯Ø®ÙˆÙ„</button>
    </div>
  </div>

  <div class="sidebar-toggle" onclick="toggleSidebar()">
    <i class="fas fa-bars"></i>
  </div>

  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h2 class="sidebar-title"><i class="fas fa-user-graduate"></i> Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
      <button class="btn btn-danger" onclick="toggleSidebar()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <ul class="sidebar-menu">
      <li><a href="#" onclick="showAddModal()"><i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</a></li>
      <li><a href="#" onclick="showDeleteModal(null)"><i class="fas fa-user-minus"></i> Ø­Ø°Ù Ø·Ø§Ù„Ø¨</a></li>
      <li><a href="#" onclick="showAllStudents()"><i class="fas fa-users"></i> Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨</a></li>
      <li><a href="#" onclick="showReports('fees')"><i class="fas fa-money-bill-wave"></i> ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</a></li>
      <li><a href="#" onclick="showReports('attendance')"><i class="fas fa-calendar-check"></i> ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ±</a></li>
      <li><a href="#" onclick="showGradeModal()"><i class="fas fa-filter"></i> ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ØµÙ</a></li>
      <li><a href="#" onclick="showTrash()"><i class="fas fa-trash"></i> Ø³Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ù„Ø§Øª</a></li>
      <li><a href="#" onclick="exportData('json')"><i class="fas fa-file-export"></i> ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</a></li>
      <li><a href="#" onclick="saveToGitHub()"><i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</a></li>
      <li><a href="#" onclick="switchDataFile()"><i class="fas fa-file-alt"></i> ØªØ¨Ø¯ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</a></li>
    </ul>
  </div>

  <div class="container">
    <div class="header">
      <h1><i class="fas fa-user-graduate"></i> Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø·Ù„Ø§Ø¨</h1>
      <div class="header-actions">
        <button class="btn" onclick="showGradeModal()"><i class="fas fa-filter"></i> ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ØµÙ</button>
        <button class="btn theme-toggle" id="themeToggle">
          <i class="fas fa-moon"></i> Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
        </button>
      </div>
    </div>

    <div class="tabs">
      <div class="tab active" onclick="switchTab('students')">
        <i class="fas fa-users"></i> Ø§Ù„Ø·Ù„Ø§Ø¨
      </div>
      <div class="tab" onclick="switchTab('posts')">
        <i class="fas fa-newspaper"></i> Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª
      </div>
      <div class="tab" onclick="switchTab('reports')">
        <i class="fas fa-chart-bar"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
      </div>
    </div>

    <div id="students-tab" class="tab-content active">
      <div class="file-info">
        <div><i class="fas fa-file-alt"></i> Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠ: <span id="currentDataFile">students.json</span></div>
        <div><i class="fas fa-users"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨: <span id="totalStudentsInFile">0</span></div>
      </div>

      <div class="control-panel">
        <input type="text" id="token" placeholder="ğŸ”‘ GitHub Token">
        <input type="text" id="searchId" placeholder="ğŸ” ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨">
        <button class="btn" onclick="searchStudent()"><i class="fas fa-search"></i> Ø¨Ø­Ø«</button>
        <div class="btn-group">
          <button class="btn btn-success" onclick="showAddModal()"><i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ©</button>
          <button class="btn btn-secondary" onclick="hideAllStudents()"><i class="fas fa-eye-slash"></i> Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙƒÙ„</button>
          <button class="btn btn-secondary" onclick="showAllStudents()"><i class="fas fa-eye"></i> Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>
          <button class="btn btn-warning" onclick="saveToGitHub()"><i class="fas fa-save"></i> Ø­ÙØ¸</button>
        </div>
      </div>

      <div id="studentsCount" style="background: var(--white); padding: 15px; border-radius: var(--radius); box-shadow: var(--shadow); margin-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <span><i class="fas fa-users"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶ÙŠÙ†: <span id="studentsCountNumber">0</span></span>
          <span><i class="fas fa-calendar-alt"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…: <span id="currentDate"></span></span>
        </div>
      </div>

      <div id="studentsCards"></div>
    </div>

    <div id="posts-tab" class="tab-content">
      <div class="posts-container">
        <div class="posts-header">
          <h2><i class="fas fa-newspaper"></i> Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</h2>
          <button class="btn btn-success" onclick="showPostModal()">
            <i class="fas fa-plus"></i> Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯
          </button>
        </div>
        <div id="postsList"></div>
      </div>
    </div>

    <div id="reports-tab" class="tab-content">
      <div class="posts-container">
        <div class="posts-header">
          <h2><i class="fas fa-chart-bar"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h2>
        </div>

        <div class="report-type-selector">
          <button class="btn report-type-btn" onclick="showReports('fees')">
            <i class="fas fa-money-bill-wave"></i> ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª
          </button>
          <button class="btn report-type-btn" onclick="showReports('attendance')">
            <i class="fas fa-calendar-check"></i> ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ±
          </button>
          <button class="btn report-type-btn" onclick="showReports('stats')">
            <i class="fas fa-chart-pie"></i> Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
          </button>
        </div>

        <div id="statsReport" class="report-section">
          <div class="stats-cards">
            <div class="stat-card total">
              <h3><i class="fas fa-users"></i> Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
              <div class="value" id="totalStudentsCount">0</div>
              <div class="description">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</div>
            </div>
            <div class="stat-card present">
              <h3><i class="fas fa-user-check"></i> Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…</h3>
              <div class="value" id="todayPresentCount">0</div>
              <div class="description">Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø§Ø¶Ø±ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…</div>
            </div>
            <div class="stat-card absent">
              <h3><i class="fas fa-user-times"></i> Ø§Ù„ØºÙŠØ§Ø¨ Ø§Ù„ÙŠÙˆÙ…</h3>
              <div class="value" id="todayAbsentCount">0</div>
              <div class="description">Ø¹Ø¯Ø¯ Ø§Ù„ØºØ§Ø¦Ø¨ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…</div>
            </div>
            <div class="stat-card paid">
              <h3><i class="fas fa-check-circle"></i> Ù…ØµØ±ÙˆÙØ§Øª Ù…Ø³Ø¯Ø¯Ø©</h3>
              <div class="value" id="paidFeesCount">0</div>
              <div class="description">Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙŠÙ† Ø³Ø¯Ø¯ÙˆØ§</div>
            </div>
            <div class="stat-card unpaid">
              <h3><i class="fas fa-exclamation-circle"></i> Ù…ØµØ±ÙˆÙØ§Øª ØºÙŠØ± Ù…Ø³Ø¯Ø¯Ø©</h3>
              <div class="value" id="unpaidFeesCount">0</div>
              <div class="description">Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙŠÙ† Ù„Ù… ÙŠØ³Ø¯Ø¯ÙˆØ§</div>
            </div>
          </div>
        </div>

        <div id="feesReport" class="report-section">
          <div class="report-header">
            <h3><i class="fas fa-money-bill-wave"></i> ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h3>
            <button class="btn btn-success" onclick="generateFeesReport()">
              <i class="fas fa-download"></i> ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            </button>
          </div>
          <div class="report-filter">
            <select id="feesGradeFilter" style="flex: 1;">
              <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ</option>
            </select>
            <select id="feesMonthFilter" style="flex: 1;">
              <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø´Ù‡Ø±</option>
            </select>
            <select id="feesStatusFilter" style="flex: 1;">
              <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
              <option value="paid">Ù…Ø³Ø¯Ø¯Ø©</option>
              <option value="unpaid">ØºÙŠØ± Ù…Ø³Ø¯Ø¯Ø©</option>
            </select>
            <button class="btn" onclick="filterFeesReport()">
              <i class="fas fa-filter"></i> ØªØµÙÙŠØ©
            </button>
          </div>
          <table class="report-table" id="feesReportTable">
            <thead>
              <tr>
                <th>ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                <th>Ø§Ù„Ø§Ø³Ù…</th>
                <th>Ø§Ù„ØµÙ</th>
                <th>Ø£ØºØ³Ø·Ø³</th>
                <th>Ø³Ø¨ØªÙ…Ø¨Ø±</th>
                <th>Ø£ÙƒØªÙˆØ¨Ø±</th>
                <th>Ù†ÙˆÙÙ…Ø¨Ø±</th>
                <th>Ø¯ÙŠØ³Ù…Ø¨Ø±</th>
                <th>ÙŠÙ†Ø§ÙŠØ±</th>
                <th>ÙØ¨Ø±Ø§ÙŠØ±</th>
                <th>Ù…Ø§Ø±Ø³</th>
                <th>Ø£Ø¨Ø±ÙŠÙ„</th>
              </tr>
            </thead>
            <tbody id="feesReportBody"></tbody>
          </table>
        </div>

        <div id="attendanceReport" class="report-section">
          <div class="report-header">
            <h3><i class="fas fa-calendar-check"></i> ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</h3>
            <button class="btn btn-success" onclick="generateAttendanceReport()">
              <i class="fas fa-download"></i> ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            </button>
          </div>
          <div class="report-filter">
            <select id="attendanceGradeFilter" style="flex: 1;">
              <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ</option>
            </select>
            <select id="attendanceDayFilter" style="flex: 1;">
              <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙŠØ§Ù…</option>
            </select>
            <select id="attendanceStatusFilter" style="flex: 1;">
              <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
              <option value="Ø­Ø§Ø¶Ø±">Ø­Ø§Ø¶Ø±</option>
              <option value="ØºØ§Ø¦Ø¨">ØºØ§Ø¦Ø¨</option>
            </select>
            <button class="btn" onclick="filterAttendanceReport()">
              <i class="fas fa-filter"></i> ØªØµÙÙŠØ©
            </button>
          </div>
          <table class="report-table" id="attendanceReportTable">
            <thead>
              <tr>
                <th>ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                <th>Ø§Ù„Ø§Ø³Ù…</th>
                <th>Ø§Ù„ØµÙ</th>
                <th>Ø§Ù„Ø³Ø¨Øª</th>
                <th>Ø§Ù„Ø£Ø­Ø¯</th>
                <th>Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†</th>
                <th>Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</th>
                <th>Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</th>
                <th>Ø§Ù„Ø®Ù…ÙŠØ³</th>
                <th>Ø§Ù„Ø¬Ù…Ø¹Ø©</th>
              </tr>
            </thead>
            <tbody id="attendanceReportBody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div id="studentModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modalTitle"><i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
        <span class="close" onclick="closeModal()">Ã—</span>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="studentId"><i class="fas fa-id-card"></i> ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨</label>
          <input type="text" id="studentId" placeholder="Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹" disabled>
        </div>
        <div class="form-group">
          <label for="studentName"><i class="fas fa-user"></i> Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</label>
          <input type="text" id="studentName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">
        </div>
        <div class="form-group">
          <label for="studentGrade"><i class="fas fa-graduation-cap"></i> Ø§Ù„ØµÙ</label>
          <select id="studentGrade">
            <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
          </select>
        </div>
        <div class="form-group">
          <label for="studentPhone"><i class="fas fa-phone"></i> Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input type="text" id="studentPhone" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
        </div>
        <div class="form-group">
          <label for="studentLevel"><i class="fas fa-star"></i> Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <select id="studentLevel">
            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰</option>
            <option value="Ø¶Ø¹ÙŠÙ">Ø¶Ø¹ÙŠÙ</option>
            <option value="Ù…Ù‚Ø¨ÙˆÙ„">Ù…Ù‚Ø¨ÙˆÙ„</option>
            <option value="Ø¬ÙŠØ¯">Ø¬ÙŠØ¯</option>
            <option value="Ø¬ÙŠØ¯ Ø¬Ø¯Ø§">Ø¬ÙŠØ¯ Ø¬Ø¯Ø§</option>
            <option value="Ù…Ù…ØªØ§Ø²">Ù…Ù…ØªØ§Ø²</option>
          </select>
        </div>
        <div class="form-group">
          <label><i class="fas fa-image"></i> ØµÙˆØ±Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <div class="image-upload-container">
            <img id="studentImagePreview" class="image-preview" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©" onclick="expandImage(this)">
            <div class="image-actions" id="imageActions">
              <button class="btn btn-small btn-danger" onclick="removeImage()">
                <i class="fas fa-trash"></i> Ø­Ø°Ù
              </button>
              <button class="btn btn-small btn-success" onclick="document.getElementById('studentImage').click()">
                <i class="fas fa-sync"></i> ØªØºÙŠÙŠØ±
              </button>
            </div>
            <button class="btn upload-btn">
              <i class="fas fa-upload"></i> Ø§Ø®ØªØ± ØµÙˆØ±Ø©
              <input type="file" id="studentImage" accept="image/*" onchange="previewStudentImage()">
            </button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeModal()">
          <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
        </button>
        <button class="btn btn-success" id="saveStudentBtn" onclick="saveStudent()">
          <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø·Ø§Ù„Ø¨
        </button>
      </div>
    </div>
  </div>

  <div id="studentDetailsModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title"><i class="fas fa-user"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
        <span class="close" onclick="closeModal()">Ã—</span>
      </div>
      <div class="modal-body">
        <div class="student-detail-card">
          <div class="student-detail-header">
            <h3 id="detailStudentName"></h3>
            <div class="student-id" id="detailStudentId"></div>
            <div class="student-grade" id="detailStudentGrade"></div>
          </div>
          <img id="detailStudentImage" class="image-preview" alt="ØµÙˆØ±Ø© Ø§Ù„Ø·Ø§Ù„Ø¨" onclick="expandImage(this)">
          <div class="student-info-item">
            <span class="student-info-label">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</span>
            <span class="student-info-value" id="detailStudentLevel"></span>
          </div>
          <div class="student-info-item">
            <span class="student-info-label">Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</span>
            <span class="student-info-value" id="detailStudentPhone"></span>
          </div>
          <div class="student-info-item">
            <span class="student-info-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</span>
            <span class="student-info-value" id="detailStudentNotes"></span>
          </div>
          <div class="qr-code-container">
            <div id="qrCode"></div>
          </div>
          <div class="action-buttons">
            <button class="btn btn-success" onclick="shareStudentDetails()">
              <i class="fas fa-share"></i> Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </button>
            <button class="btn btn-primary" onclick="downloadStudentCard()">
              <i class="fas fa-download"></i> Ø­ÙØ¸ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
            </button>
            <button class="btn btn-warning" onclick="showNotesModal()">
              <i class="fas fa-sticky-note"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø©
            </button>
            <button class="btn btn-primary" onclick="showFeesModal()">
              <i class="fas fa-money-bill"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª
            </button>
            <button class="btn btn-primary" onclick="showAttendanceModal()">
              <i class="fas fa-calendar-check"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¶ÙˆØ±
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="notesModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title"><i class="fas fa-sticky-note"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
        <span class="close" onclick="closeModal()">Ã—</span>
      </div>
      <div class="modal-body">
        <textarea id="notesContent" rows="8" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ù† Ø§Ù„Ø·Ø§Ù„Ø¨..."></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeModal()">
          <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
        </button>
        <button class="btn btn-success" onclick="saveNotes()">
          <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
        </button>
      </div>
    </div>
  </div>

  <div id="feesModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title"><i class="fas fa-money-bill"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h3>
        <span class="close" onclick="closeModal()">Ã—</span>
      </div>
      <div class="modal-body">
        <div class="fees-grid">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeModal()">
          <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
        </button>
        <button class="btn btn-success" onclick="saveFees()">
          <i class="fas fa-save"></i> Ø­ÙØ¸
        </button>
      </div>
    </div>
  </div>

  <div id="attendanceModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title"><i class="fas fa-calendar-check"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
        <span class="close" onclick="closeModal()">Ã—</span>
      </div>
      <div class="modal-body">
        <div class="attendance-grid">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeModal()">
          <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
        </button>
        <button class="btn btn-success" onclick="saveAttendance()">
          <i class="fas fa-save"></i> Ø­ÙØ¸
        </button>
      </div>
    </div>
  </div>

  <div id="postModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="postModalTitle"><i class="fas fa-plus"></i> Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯</h3>
        <span class="close" onclick="closePostModal()">Ã—</span>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="editPostTitle"><i class="fas fa-heading"></i> Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù†Ø´ÙˆØ±</label>
          <input type="text" id="editPostTitle" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù†Ø´ÙˆØ±">
        </div>
        <div class="form-group">
          <label for="editPostContent"><i class="fas fa-align-left"></i> Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</label>
          <textarea id="editPostContent" rows="6" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù†Ø´ÙˆØ±"></textarea>
        </div>
        <div class="form-group">
          <label><i class="fas fa-image"></i> ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†Ø´ÙˆØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <div class="image-upload-container">
            <img id="postImagePreview" class="image-preview" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©" onclick="expandImage(this)">
            <div class="image-actions" id="postImageActions">
              <button class="btn btn-small btn-danger" onclick="removePostImage()">
                <i class="fas fa-trash"></i> Ø­Ø°Ù
              </button>
              <button class="btn btn-small btn-success" onclick="document.getElementById('postImageInput').click()">
                <i class="fas fa-sync"></i> ØªØºÙŠÙŠØ±
              </button>
            </div>
            <button class="btn upload-btn">
              <i class="fas fa-upload"></i> Ø§Ø®ØªØ± ØµÙˆØ±Ø©
              <input type="file" id="postImageInput" accept="image/*" onchange="previewPostImage()">
            </button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closePostModal()">
          <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
        </button>
        <button class="btn btn-success" id="savePostBtn">
          <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ù…Ù†Ø´ÙˆØ±
        </button>
      </div>
    </div>
  </div>

  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title"><i class="fas fa-user-minus"></i> Ø­Ø°Ù Ø·Ø§Ù„Ø¨</h3>
        <span class="close" onclick="closeModal()">Ã—</span>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="deleteStudentId"><i class="fas fa-id-card"></i> ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨</label>
          <input type="text" id="deleteStudentId" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeModal()">
          <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
        </button>
        <button class="btn btn-danger" onclick="deleteStudent()">
          <i class="fas fa-trash"></i> Ø­Ø°Ù
        </button>
      </div>
    </div>
  </div>

  <div id="gradeModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title"><i class="fas fa-filter"></i> ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ØµÙ</h3>
        <span class="close" onclick="closeModal()">Ã—</span>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="filterGrade"><i class="fas fa-graduation-cap"></i> Ø§Ø®ØªØ± Ø§Ù„ØµÙ</label>
          <select id="filterGrade">
            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeModal()">
          <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
        </button>
        <button class="btn btn-success" onclick="filterByGrade()">
          <i class="fas fa-filter"></i> ØªØµÙÙŠØ©
        </button>
      </div>
    </div>
  </div>

  <div id="trashModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title"><i class="fas fa-trash"></i> Ø³Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ù„Ø§Øª</h3>
        <span class="close" onclick="closeModal()">Ã—</span>
      </div>
      <div class="modal-body">
        <div id="trashList"></div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeModal()">
          <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
        </button>
      </div>
    </div>
  </div>

  <script>
    let students = {};
    let allStudentsData = {};
    let posts = {};
    let trash = {};
    let currentStudentId = null;
    let deleteStudentId = null;
    let currentPostId = null;
    let studentImageFile = null;
    let postImageFile = null;
    let isLoading = false;
    let currentDataFile = 'students.json';
    let secondaryDataFile = 'students2.json';
    let isPrimaryFileActive = true;
    const owner = 'Devolepor';
    const repo = 'app';
    const branch = 'main';
    const path = 'students.json';
    const postsPath = 'posts.json';
    const trashPath = 'trash.json';
    const secondaryPath = 'students2.json';
    const MAX_FILE_SIZE = 1000000; // 1MB
    let sha = '';
    let originalButtonText = '';

    const months = ['Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±', 'ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„'];
    const weekDays = ['Ø§Ù„Ø³Ø¨Øª', 'Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©'];

    function checkLogin() {
      const password = document.getElementById('loginPassword').value;
      if (password === '010135685900122327731001150929598') {
        localStorage.setItem('isLoggedIn', 'true');
        document.getElementById('loginScreen').style.display = 'none';
        loadAllStudentsData();
        loadPosts();
        loadTrash();
        fillGradeSelects();
        const today = new Date();
        document.getElementById('currentDate').textContent = today.toLocaleDateString('ar-EG');
      } else {
        Swal.fire({
          title: 'Ø®Ø·Ø£',
          text: 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©',
          icon: 'error',
          confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
        });
      }
    }

    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('open');
    }

    function switchTab(tabName) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      document.querySelector(`.tab[onclick="switchTab('${tabName}')"]`).classList.add('active');
      document.getElementById(`${tabName}-tab`).classList.add('active');
      if (tabName === 'reports') {
        showReports('stats');
      }
      if (tabName === 'posts') {
        renderPosts();
      }
    }

    function showAddModal() {
      currentStudentId = null;
      document.getElementById('modalTitle').innerHTML = '<i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯';
      document.getElementById('studentId').value = generateStudentId();
      document.getElementById('studentName').value = '';
      document.getElementById('studentGrade').value = '';
      document.getElementById('studentPhone').value = '';
      document.getElementById('studentLevel').value = '';
      document.getElementById('studentImagePreview').style.display = 'none';
      document.getElementById('imageActions').style.display = 'none';
      document.getElementById('studentModal').style.display = 'block';
    }

    function generateStudentId() {
      return 'STU' + Math.floor(1000 + Math.random() * 9000);
    }

    function fillGradeSelects() {
      const grades = ['Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ', 'Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ', 'Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ', 'Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ', 'Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ', 'Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ'];
      const selects = ['studentGrade', 'feesGradeFilter', 'attendanceGradeFilter', 'filterGrade'];
      selects.forEach(selectId => {
        const select = document.getElementById(selectId);
        select.innerHTML = selectId === 'filterGrade' ? '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ</option>' : '<option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>';
        grades.forEach(grade => {
          const option = document.createElement('option');
          option.value = grade;
          option.textContent = grade;
          select.appendChild(option);
        });
      });

      const monthSelect = document.getElementById('feesMonthFilter');
      monthSelect.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø´Ù‡Ø±</option>';
      months.forEach(month => {
        const option = document.createElement('option');
        option.value = month;
        option.textContent = month;
        monthSelect.appendChild(option);
      });

      const daySelect = document.getElementById('attendanceDayFilter');
      daySelect.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙŠØ§Ù…</option>';
      weekDays.forEach(day => {
        const option = document.createElement('option');
        option.value = day;
        option.textContent = day;
        daySelect.appendChild(option);
      });
    }

    async function loadAllStudentsData() {
      const token = document.getElementById('token').value || localStorage.getItem('gh_token');
      if (!token) return;

      try {
        showLoading(true);
        const files = [path, secondaryPath];
        allStudentsData = {};

        for (let file of files) {
          try {
            const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${file}`, {
              headers: { 'Authorization': `token ${token}` }
            });
            if (res.ok) {
              const data = await res.json();
              const content = JSON.parse(atob(data.content));
              for (let id in content) {
                allStudentsData[id] = { ...content[id], _file: file.split('/').pop() };
              }
            }
          } catch (error) {
            console.log(`Ù…Ù„Ù ${file} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯`);
          }
        }

        students = { ...allStudentsData };
        if (isPrimaryFileActive) {
          students = Object.fromEntries(
            Object.entries(allStudentsData).filter(([_, student]) => student._file === currentDataFile)
          );
        }
        renderStudentCards();
        document.getElementById('totalStudentsInFile').textContent = Object.keys(students).length;
        updateStats();
      } catch (error) {
        showError('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message);
      } finally {
        showLoading(false);
      }
    }

    async function loadPosts() {
      const token = document.getElementById('token').value || localStorage.getItem('gh_token');
      if (!token) return;

      try {
        const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${postsPath}`, {
          headers: { 'Authorization': `token ${token}` }
        });
        if (res.ok) {
          const data = await res.json();
          posts = JSON.parse(atob(data.content));
          renderPosts();
        }
      } catch (error) {
        console.log('Ù…Ù„Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
      }
    }

    async function loadTrash() {
      const token = document.getElementById('token').value || localStorage.getItem('gh_token');
      if (!token) return;

      try {
        const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${trashPath}`, {
          headers: { 'Authorization': `token ${token}` }
        });
        if (res.ok) {
          const data = await res.json();
          trash = JSON.parse(atob(data.content));
        }
      } catch (error) {
        console.log('Ù…Ù„Ù Ø³Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ù„Ø§Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
      }
    }

    function calculateFileSize(data) {
      return new Blob([JSON.stringify(data)]).size;
    }

    function createNewDataFile() {
      if (calculateFileSize(students) >= MAX_FILE_SIZE) {
        isPrimaryFileActive = false;
        currentDataFile = secondaryDataFile;
        students = {};
        document.getElementById('currentDataFile').textContent = currentDataFile;
      }
    }

    function switchDataFile() {
      isPrimaryFileActive = !isPrimaryFileActive;
      currentDataFile = isPrimaryFileActive ? 'students.json' : secondaryDataFile;
      document.getElementById('currentDataFile').textContent = currentDataFile;
      students = Object.fromEntries(
        Object.entries(allStudentsData).filter(([_, student]) => student._file === currentDataFile)
      );
      renderStudentCards();
      document.getElementById('totalStudentsInFile').textContent = Object.keys(students).length;
    }

    function renderStudentCards() {
      const cardsContainer = document.getElementById('studentsCards');
      cardsContainer.innerHTML = '';

      if (Object.keys(students).length === 0) {
        cardsContainer.innerHTML = `
          <div class="no-students">
            <h3><i class="fas fa-info-circle"></i> Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
          </div>
        `;
        return;
      }

      for (let id in students) {
        const student = students[id];
        const card = document.createElement('div');
        card.className = 'student-card';
        card.innerHTML = `
          <img src="${student.image || 'https://via.placeholder.com/40'}" class="student-image-thumb" alt="ØµÙˆØ±Ø© Ø§Ù„Ø·Ø§Ù„Ø¨">
          <div class="edit-student-btn" onclick="editStudent('${id}')"><i class="fas fa-edit"></i></div>
          <div class="student-header" onclick="showStudentDetails('${id}')">
            <div>
              <div class="student-name">${student.name}</div>
              <div class="student-id">${id}</div>
            </div>
            <div class="student-grade">${student.main}</div>
            <div class="student-level level-${student.info ? student.info.replace(' ', '-') : 'none'}">${student.info || '-'}</div>
          </div>
        `;
        cardsContainer.appendChild(card);
      }

      document.getElementById('studentsCountNumber').textContent = Object.keys(students).length;
    }

    function showStudentDetails(id) {
      const student = students[id];
      currentStudentId = id;

      document.getElementById('detailStudentName').textContent = student.name;
      document.getElementById('detailStudentId').textContent = id;
      document.getElementById('detailStudentGrade').textContent = student.main;
      document.getElementById('detailStudentLevel').textContent = student.info || '-';
      document.getElementById('detailStudentPhone').textContent = student.phone || '-';
      document.getElementById('detailStudentNotes').textContent = student.notes || '-';
      const image = document.getElementById('detailStudentImage');
      image.src = student.image || 'https://via.placeholder.com/150';
      image.style.display = student.image ? 'block' : 'none';

      const qrCodeContainer = document.getElementById('qrCode');
      qrCodeContainer.innerHTML = '';
      if (student.phone) {
        new QRCode(qrCodeContainer, {
          text: `https://wa.me/${student.phone}?text=Ø­Ø§Ø¶Ø±`,
          width: 128,
          height: 128
        });
      }

      document.getElementById('studentDetailsModal').style.display = 'block';
    }

    function shareStudentDetails() {
      const student = students[currentStudentId];
      const shareText = `
        Ø§Ù„Ø·Ø§Ù„Ø¨: ${student.name}
        Ø§Ù„ÙƒÙˆØ¯: ${currentStudentId}
        Ø§Ù„ØµÙ: ${student.main}
        Ø§Ù„Ù…Ø³ØªÙˆÙ‰: ${student.info || '-'}
        Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±: ${student.phone || '-'}
        Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${student.notes || '-'}`;
      const encodedText = encodeURIComponent(shareText);

      Swal.fire({
        title: 'Ù…Ø´Ø§Ø±ÙƒØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨',
        html: `
          <div style="text-align: right;">
            <p>Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©:</p>
            <div class="share-buttons">
              <a href="https://wa.me/?text=${encodedText}" target="_blank" class="btn btn-success">
                <i class="fab fa-whatsapp"></i> ÙˆØ§ØªØ³Ø§Ø¨
              </a>
              <a href="https://m.me/share/?text=${encodedText}" target="_blank" class="btn btn-primary">
                <i class="fab fa-telegram-plane"></i> Ù…Ø§Ø³Ù†Ø¬Ø±
              </a>
            </div>
          </div>`,
        showConfirmButton: false
      });
    }

    function downloadStudentCard() {
      const student = students[currentStudentId];
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFont('Tajawal', 'normal');
      doc.setTextColor(33, 150, 243);
      doc.setFontSize(22);
      doc.text('Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø·Ø§Ù„Ø¨', 105, 15, null, null, 'center');

      doc.setFontSize(12);
      doc.setTextColor(0, 0, 0);
      let y = 30;
      doc.text(`Ø§Ù„Ø§Ø³Ù…: ${student.name}`, 14, y);
      y += 10;
      doc.text(`ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨: ${currentStudentId}`, 14, y);
      y += 10;
      doc.text(`Ø§Ù„ØµÙ: ${student.main}`, 14, y);
      y += 10;
      doc.text(`Ø§Ù„Ù…Ø³ØªÙˆÙ‰: ${student.info || '-'}`, 14, y);
      y += 10;
      if (student.phone) {
        doc.text(`Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±: ${student.phone}`, 14, y);
        y += 10;
      }
      if (student.notes) {
        doc.text('Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:', 14, y);
        y += 10;
        doc.text(student.notes, 14, y, { maxWidth: 180 });
      }

      if (student.image) {
        try {
          doc.addImage(student.image, 'PNG', 160, 30, 40, 40);
        } catch (error) {
          console.log('ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ PDF:', error);
        }
      }

      doc.save(`Ø¨Ø·Ø§Ù‚Ø©_Ø§Ù„Ø·Ø§Ù„Ø¨_${currentStudentId}.pdf`);
    }

    function showFeesModal() {
      const student = students[currentStudentId];
      const feesGrid = document.querySelector('#feesModal .fees-grid');
      feesGrid.innerHTML = '';

      months.forEach(month => {
        const item = document.createElement('div');
        item.className = 'fee-item';
        item.innerHTML = `
          <span>${month}</span>
          <select class="fee-status" data-month="${month}">
            <option value="ØºÙŠØ± Ù…Ø³Ø¯Ø¯Ø©" ${!student.fees[month] ? 'selected' : ''}>ØºÙŠØ± Ù…Ø³Ø¯Ø¯Ø©</option>
            <option value="Ù…Ø³Ø¯Ø¯Ø©" ${student.fees[month] ? 'selected' : ''}>Ù…Ø³Ø¯Ø¯Ø©</option>
          </select>`;
        feesGrid.appendChild(item);
      });

      document.getElementById('feesModal').style.display = 'block';
    }

    function saveFees() {
      const student = students[currentStudentId];
      const selects = document.querySelectorAll('#feesModal .fee-status');

      selects.forEach(select => {
        const month = select.dataset.month;
        student.fees[month] = select.value === 'Ù…Ø³Ø¯Ø¯Ø©';
      });

      allStudentsData[currentStudentId].fees = { ...student.fees };
      saveToGitHub();
      closeModal();
      showSuccess('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­');
    }

    function showAttendanceModal() {
      const student = students[currentStudentId];
      const attendanceGrid = document.querySelector('#attendanceModal .attendance-grid');
      attendanceGrid.innerHTML = '';

      weekDays.forEach(day => {
        const item = document.createElement('div');
        item.className = 'attendance-item';
        item.innerHTML = `
          <span>${day}</span>
          <select class="attendance-status" data-day="${day}">
            <option value="-" ${!student.attendance[day] ? 'selected' : ''}>-</option>
            <option value="Ø­Ø§Ø¶Ø±" ${student.attendance[day] === 'Ø­Ø§Ø¶Ø±' ? 'selected' : ''}>Ø­Ø§Ø¶Ø±</option>
            <option value="ØºØ§Ø¦Ø¨" ${student.attendance[day] === 'ØºØ§Ø¦Ø¨' ? 'selected' : ''}>ØºØ§Ø¦Ø¨</option>
          </select>`;
        attendanceGrid.appendChild(item);
      });

      document.getElementById('attendanceModal').style.display = 'block';
    }

    function saveAttendance() {
      const student = students[currentStudentId];
      const selects = document.querySelectorAll('#attendanceModal .attendance-status');

      selects.forEach(select => {
        const day = select.dataset.day;
        student.attendance[day] = select.value;
      });

      allStudentsData[currentStudentId].attendance = { ...student.attendance };
      saveToGitHub();
      closeModal();
      showSuccess('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­');
    }

    function showNotesModal() {
      const student = students[currentStudentId];
      document.getElementById('notesContent').value = student.notes || '';
      document.getElementById('notesModal').style.display = 'block';
    }

    function saveNotes() {
      const notes = document.getElementById('notesContent').value;
      students[currentStudentId].notes = notes;
      allStudentsData[currentStudentId].notes = notes;
      saveToGitHub();
      closeModal();
      showSuccess('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
      showStudentDetails(currentStudentId);
    }

    function saveStudent() {
      const id = document.getElementById('studentId').value.trim();
      const name = document.getElementById('studentName').value.trim();
      const grade = document.getElementById('studentGrade').value;
      const phone = document.getElementById('studentPhone').value.trim();
      const level = document.getElementById('studentLevel').value;

      if (!id || !name || !grade) {
        showError('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
        return;
      }

      if (currentStudentId === null && allStudentsData[id]) {
        showError('ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹');
        return;
      }

      const studentData = {
        name,
        main: grade,
        info: level || undefined,
        phone: phone || undefined,
        notes: phone ? `QR Code Ù„Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±: https://wa.me/${phone}?text=Ø­Ø§Ø¶Ø±\n\n` : '',
        attendance: Object.fromEntries(weekDays.map(day => [day, "-"])),
        fees: Object.fromEntries(months.map(month => [month, false])),
        _file: currentDataFile
      };

      if (currentStudentId === null) {
        students[id] = studentData;
        allStudentsData[id] = { ...studentData };
      } else {
        if (currentStudentId !== id) {
          delete students[currentStudentId];
          delete allStudentsData[currentStudentId];
        }
        students[id] = { ...studentData, attendance: students[currentStudentId]?.attendance || studentData.attendance, fees: students[currentStudentId]?.fees || studentData.fees };
        allStudentsData[id] = { ...students[id] };
      }

      if (studentImageFile) {
        const reader = new FileReader();
        reader.onload = function(e) {
          students[id].image = e.target.result;
          allStudentsData[id].image = e.target.result;
          saveToGitHub();
          renderStudentCards();
          closeModal();
          showStudentDetails(id);
          showSuccess('ØªÙ… Ø¥Ø¶Ø§ÙØ©/ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
        };
        reader.readAsDataURL(studentImageFile);
      } else {
        if (document.getElementById('studentImagePreview').style.display === 'none') {
          delete students[id].image;
          delete allStudentsData[id].image;
        }
        saveToGitHub();
        renderStudentCards();
        closeModal();
        showStudentDetails(id);
        showSuccess('ØªÙ… Ø¥Ø¶Ø§ÙØ©/ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
      }
    }

    function editStudent(id) {
      const student = students[id];
      currentStudentId = id;
      document.getElementById('modalTitle').innerHTML = '<i class="fas fa-user-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨';
      document.getElementById('studentId').value = id;
      document.getElementById('studentName').value = student.name;
      document.getElementById('studentGrade').value = student.main;
      document.getElementById('studentPhone').value = student.phone || '';
      document.getElementById('studentLevel').value = student.info || '';
      const preview = document.getElementById('studentImagePreview');
      const actions = document.getElementById('imageActions');
      if (student.image) {
        preview.src = student.image;
        preview.style.display = 'block';
        actions.style.display = 'flex';
      } else {
        preview.style.display = 'none';
        actions.style.display = 'none';
      }
      document.getElementById('studentModal').style.display = 'block';
    }

    function showDeleteModal(id) {
      deleteStudentId = id;
      document.getElementById('deleteStudentId').value = id || '';
      document.getElementById('deleteModal').style.display = 'block';
    }

    function deleteStudent() {
      const id = document.getElementById('deleteStudentId').value.trim();
      if (!id || !allStudentsData[id]) {
        showError('ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
        return;
      }

      Swal.fire({
        title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
        text: 'Ø³ÙŠØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¥Ù„Ù‰ Ø³Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ù„Ø§Øª!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù',
        cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
      }).then(result => {
        if (result.isConfirmed) {
          trash[id] = { ...allStudentsData[id], deletedAt: new Date().toLocaleString('ar-EG') };
          delete students[id];
          delete allStudentsData[id];
          saveToGitHub();
          saveTrashToGitHub();
          renderStudentCards();
          closeModal();
          showSuccess('ØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¥Ù„Ù‰ Ø³Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ù„Ø§Øª');
        }
      });
    }

    function showTrash() {
      const trashList = document.getElementById('trashList');
      trashList.innerHTML = '';

      if (Object.keys(trash).length === 0) {
        trashList.innerHTML = `
          <div class="no-students">
            <h3><i class="fas fa-info-circle"></i> Ø³Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ù„Ø§Øª ÙØ§Ø±ØºØ©</h3>
          </div>
        `;
      } else {
        for (let id in trash) {
          const student = trash[id];
          const item = document.createElement('div');
          item.className = 'student-card';
          item.innerHTML = `
            <div class="student-header">
              <div>
                <div class="student-name">${student.name}</div>
                <div class="student-id">${id}</div>
              </div>
              <div class="student-grade">${student.main}</div>
              <div class="student-level">${student.info || '-'}</div>
            </div>
            <div class="action-buttons">
              <button class="btn btn-success" onclick="restoreStudent('${id}')">
                <i class="fas fa-undo"></i> Ø§Ø³ØªØ±Ø¬Ø§Ø¹
              </button>
              <button class="btn btn-danger" onclick="permanentlyDeleteStudent('${id}')">
                <i class="fas fa-trash-alt"></i> Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ
              </button>
            </div>`;
          trashList.appendChild(item);
        }
      }

      document.getElementById('trashModal').style.display = 'block';
    }

    function restoreStudent(id) {
      Swal.fire({
        title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
        text: 'Ø³ÙŠØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø³ØªØ±Ø¬Ø¹',
        cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
      }).then(result => {
        if (result.isConfirmed) {
          const student = trash[id];
          student._file = currentDataFile;
          students[id] = student;
          allStudentsData[id] = student;
          delete trash[id];
          saveToGitHub();
          saveTrashToGitHub();
          renderStudentCards();
          closeModal();
          showSuccess('ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
        }
      });
    }

    function permanentlyDeleteStudent(id) {
      Swal.fire({
        title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
        text: 'Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹',
        cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
      }).then(result => {
        if (result.isConfirmed) {
          delete trash[id];
          saveTrashToGitHub();
          showTrash();
          showSuccess('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹');
        }
      });
    }

    function showGradeModal() {
      document.getElementById('gradeModal').style.display = 'block';
    }

    function filterByGrade() {
      const grade = document.getElementById('filterGrade').value;
      students = grade
        ? Object.fromEntries(
            Object.entries(allStudentsData).filter(([_, student]) => student.main === grade && student._file === currentDataFile)
          )
        : Object.fromEntries(
            Object.entries(allStudentsData).filter(([_, student]) => student._file === currentDataFile)
          );
      renderStudentCards();
      closeModal();
    }

    function searchStudent() {
      const id = document.getElementById('searchId').value.trim();
      if (!id) {
        showAllStudents();
        return;
      }
      if (allStudentsData[id]) {
        students = { [id]: allStudentsData[id] };
      } else {
        students = {};
        showError('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§Ù„Ø¨');
      }
      renderStudentCards();
    }

    function showAllStudents() {
      students = Object.fromEntries(
        Object.entries(allStudentsData).filter(([_, student]) => student._file === currentDataFile)
          );

      renderStudentCards();
    }

    function previewStudentImage() {
      const file = document.getElementById('studentImage').files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = document.getElementById('studentImagePreview');
          img.src = e.target.result;
          img.style.display = 'block';
          document.getElementById('imageActions').style.display = 'flex';
          studentImageFile = file;
        };
        reader.readAsDataURL(file);
      }
    }

    function previewPostImage() {
      const file = document.getElementById('postImageInput').files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = document.getElementById('postImagePreview');
          img.src = e.target.result;
          img.style.display = 'block';
          document.getElementById('postImageActions').style.display = 'flex';
          postImageFile = file;
        };
        reader.readAsDataURL(file);
      }
    }

    function removeImage() {
      studentImageFile = null;
      const preview = document.getElementById('studentImagePreview');
      preview.style.display = 'none';
      document.getElementById('imageActions').style.display = 'none';
      document.getElementById('studentImage').value = '';
    }

    function removePostImage() {
      postImageFile = null;
      const preview = document.getElementById('postImagePreview');
      preview.style.display = 'none';
      document.getElementById('postImageActions').style.display = 'none';
      document.getElementById('postImageInput').value = '';
    }

    function expandImage(imgElement) {
      const modal = document.getElementById('imageModal');
      const modalImg = document.getElementById('expandedImage');
      modalImg.src = imgElement.src;
      modal.style.display = 'block';
    }

    function closeImageModal() {
      document.getElementById('imageModal').style.display = 'none';
    }

    function showPostModal(id = null) {
      currentPostId = id;
      document.getElementById('postModalTitle').innerHTML = id ? '<i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ±' : '<i class="fas fa-plus"></i> Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯';
      document.getElementById('editPostTitle').value = id ? posts[id].title : '';
      document.getElementById('editPostContent').value = id ? posts[id].content : '';
      const preview = document.getElementById('postImagePreview');
      const actions = document.getElementById('postImageActions');
      if (id && posts[id].image) {
        preview.src = posts[id].image;
        preview.style.display = 'block';
        actions.style.display = 'flex';
      } else {
        preview.style.display = 'none';
        actions.style.display = 'none';
      }
      document.getElementById('postModal').style.display = 'block';
      document.getElementById('savePostBtn').onclick = id ? () => savePost(id) : savePost;
    }

    function savePost(id = null) {
      const title = document.getElementById('editPostTitle').value.trim();
      const content = document.getElementById('editPostContent').value.trim();

      if (!title || !content) {
        showError('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
        return;
      }

      const postData = {
        title,
        content,
        date: new Date().toLocaleString('ar-EG'),
        author: 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©',
        likes: id ? posts[id].likes || 0 : 0
      };

      if (postImageFile) {
        const reader = new FileReader();
        reader.onload = function(e) {
          postData.image = e.target.result;
          if (id) {
            posts[id] = postData;
          } else {
            const newId = 'POST' + Math.floor(1000 + Math.random() * 9000);
            posts[newId] = postData;
          }
          savePostsToGitHub();
          renderPosts();
          closePostModal();
          showSuccess('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­');
        };
        reader.readAsDataURL(postImageFile);
      } else {
        if (id && document.getElementById('postImagePreview').style.display === 'none') {
          delete postData.image;
        } else if (id) {
          postData.image = posts[id].image;
        }
        if (id) {
          posts[id] = postData;
        } else {
          const newId = 'POST' + Math.floor(1000 + Math.random() * 9000);
          posts[newId] = postData;
        }
        savePostsToGitHub();
        renderPosts();
        closePostModal();
        showSuccess('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­');
      }
    }

    function renderPosts() {
      const postsList = document.getElementById('postsList');
      postsList.innerHTML = '';

      if (Object.keys(posts).length === 0) {
        postsList.innerHTML = `
          <div class="no-students">
            <h3><i class="fas fa-info-circle"></i> Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
          </div>
        `;
        return;
      }

      for (let id in posts) {
        const post = posts[id];
        const postElement = document.createElement('div');
        postElement.className = 'post';
        postElement.innerHTML = `
          <div class="post-delete" onclick="deletePost('${id}')"><i class="fas fa-trash"></i></div>
          <div class="post-header">
            <div class="post-avatar">${post.author[0]}</div>
            <div>
              <div class="post-author">${post.author}</div>
              <div class="post-date">${post.date}</div>
            </div>
          </div>
          <h3>${post.title}</h3>
          <div class="post-content">${post.content}</div>
          ${post.image ? `<img src="${post.image}" class="post-image" onclick="expandImage(this)">` : ''}
          <div class="post-actions">
            <span class="post-action ${post.liked ? 'liked' : ''}" onclick="toggleLike('${id}')">
              <i class="fas fa-heart"></i> <span class="like-count">${post.likes || 0}</span>
            </span>
            <span class="post-action" onclick="showPostModal('${id}')">
              <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
            </span>
          </div>
        `;
        postsList.appendChild(postElement);
      }
    }

    function toggleLike(postId) {
      posts[postId].likes = posts[postId].likes || 0;
      posts[postId].liked = !posts[postId].liked;
      posts[postId].likes += posts[postId].liked ? 1 : -1;
      savePostsToGitHub();
      renderPosts();
    }

    function deletePost(id) {
      Swal.fire({
        title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
        text: 'Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù',
        cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
      }).then(result => {
        if (result.isConfirmed) {
          delete posts[id];
          savePostsToGitHub();
          renderPosts();
          showSuccess('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­');
        }
      });
    }

    function updateStats() {
      const totalStudents = Object.keys(students).length;
      let todayPresent = 0;
      let todayAbsent = 0;
      let paidFees = 0;
      let unpaidFees = 0;

      const today = new Date().toLocaleDateString('ar-EG', { weekday: 'long' });
      for (let id in students) {
        const student = students[id];
        if (student.attendance[today] === 'Ø­Ø§Ø¶Ø±') todayPresent++;
        if (student.attendance[today] === 'ØºØ§Ø¦Ø¨') todayAbsent++;
        const paidMonths = Object.values(student.fees).filter(status => status).length;
        if (paidMonths === months.length) paidFees++;
        else if (paidMonths === 0) unpaidFees++;
      }

      document.getElementById('totalStudentsCount').textContent = totalStudents;
      document.getElementById('todayPresentCount').textContent = todayPresent;
      document.getElementById('todayAbsentCount').textContent = todayAbsent;
      document.getElementById('paidFeesCount').textContent = paidFees;
      document.getElementById('unpaidFeesCount').textContent = unpaidFees;
    }

    function showReports(type) {
      document.querySelectorAll('.report-section').forEach(section => section.style.display = 'none');
      document.querySelectorAll('.report-type-btn').forEach(btn => btn.classList.remove('btn-primary'));
      document.querySelector(`.report-type-btn[onclick="showReports('${type}')"]`).classList.add('btn-primary');
      document.getElementById(`${type}Report`).style.display = 'block';

      if (type === 'fees') {
        renderFeesReport();
      } else if (type === 'attendance') {
        renderAttendanceReport();
      } else if (type === 'stats') {
        updateStats();
      }
    }

    function renderFeesReport() {
      const gradeFilter = document.getElementById('feesGradeFilter').value;
      const monthFilter = document.getElementById('feesMonthFilter').value;
      const statusFilter = document.getElementById('feesStatusFilter').value;
      const tbody = document.getElementById('feesReportBody');
      tbody.innerHTML = '';

      let filteredStudents = Object.entries(students);
      if (gradeFilter) {
        filteredStudents = filteredStudents.filter(([_, student]) => student.main === gradeFilter);
      }

      filteredStudents.forEach(([id, student]) => {
        let include = true;
        if (monthFilter && statusFilter) {
          const status = student.fees[monthFilter] ? 'Ù…Ø³Ø¯Ø¯Ø©' : 'ØºÙŠØ± Ù…Ø³Ø¯Ø¯Ø©';
          include = status === statusFilter;
        }
        if (include) {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${id}</td>
            <td>${student.name}</td>
            <td>${student.main}</td>
            ${months.map(month => `<td>${student.fees[month] ? 'âœ… Ù…Ø³Ø¯Ø¯Ø©' : 'âŒ ØºÙŠØ± Ù…Ø³Ø¯Ø¯Ø©'}</td>`).join('')}
          `;
          tbody.appendChild(row);
        }
      });
    }

    function filterFeesReport() {
      renderFeesReport();
    }

    function renderAttendanceReport() {
      const gradeFilter = document.getElementById('attendanceGradeFilter').value;
      const dayFilter = document.getElementById('attendanceDayFilter').value;
      const statusFilter = document.getElementById('attendanceStatusFilter').value;
      const tbody = document.getElementById('attendanceReportBody');
      tbody.innerHTML = '';

      let filteredStudents = Object.entries(students);
      if (gradeFilter) {
        filteredStudents = filteredStudents.filter(([_, student]) => student.main === gradeFilter);
      }

      filteredStudents.forEach(([id, student]) => {
        let include = true;
        if (dayFilter && statusFilter) {
          include = student.attendance[dayFilter] === statusFilter;
        }
        if (include) {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${id}</td>
            <td>${student.name}</td>
            <td>${student.main}</td>
            ${weekDays.map(day => `<td>${student.attendance[day] || '-'}</td>`).join('')}
          `;
          tbody.appendChild(row);
        }
      });
    }

    function filterAttendanceReport() {
      renderAttendanceReport();
    }

    function generateFeesReport() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFont('Tajawal', 'normal');
      doc.setTextColor(33, 150, 243);
      doc.setFontSize(22);
      doc.text('ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª', 105, 15, null, null, 'center');

      let y = 30;
      doc.setFontSize(12);
      doc.setTextColor(0, 0, 0);
      doc.text('ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ | Ø§Ù„Ø§Ø³Ù… | Ø§Ù„ØµÙ | ' + months.join(' | '), 14, y);
      y += 10;

      const gradeFilter = document.getElementById('feesGradeFilter').value;
      const monthFilter = document.getElementById('feesMonthFilter').value;
      const statusFilter = document.getElementById('feesStatusFilter').value;

      let filteredStudents = Object.entries(students);
      if (gradeFilter) {
        filteredStudents = filteredStudents.filter(([_, student]) => student.main === gradeFilter);
      }

      filteredStudents.forEach(([id, student]) => {
        let include = true;
        if (monthFilter && statusFilter) {
          const status = student.fees[monthFilter] ? 'Ù…Ø³Ø¯Ø¯Ø©' : 'ØºÙŠØ± Ù…Ø³Ø¯Ø¯Ø©';
          include = status === statusFilter;
        }
        if (include) {
          const row = `${id} | ${student.name} | ${student.main} | ${months.map(month => student.fees[month] ? 'Ù…Ø³Ø¯Ø¯Ø©' : 'ØºÙŠØ± Ù…Ø³Ø¯Ø¯Ø©').join(' | ')}`;
          doc.text(row, 14, y);
          y += 10;
        }
      });

      doc.save('ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª.pdf');
    }

    function generateAttendanceReport() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFont('Tajawal', 'normal');
      doc.setTextColor(33, 150, 243);
      doc.setFontSize(22);
      doc.text('ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨', 105, 15, null, null, 'center');

      let y = 30;
      doc.setFontSize(12);
      doc.setTextColor(0, 0, 0);
      doc.text('ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ | Ø§Ù„Ø§Ø³Ù… | Ø§Ù„ØµÙ | ' + weekDays.join(' | '), 14, y);
      y += 10;

      const gradeFilter = document.getElementById('attendanceGradeFilter').value;
      const dayFilter = document.getElementById('attendanceDayFilter').value;
      const statusFilter = document.getElementById('attendanceStatusFilter').value;

      let filteredStudents = Object.entries(students);
      if (gradeFilter) {
        filteredStudents = filteredStudents.filter(([_, student]) => student.main === gradeFilter);
      }

      filteredStudents.forEach(([id, student]) => {
        let include = true;
        if (dayFilter && statusFilter) {
          include = student.attendance[dayFilter] === statusFilter;
        }
        if (include) {
          const row = `${id} | ${student.name} | ${student.main} | ${weekDays.map(day => student.attendance[day] || '-').join(' | ')}`;
          doc.text(row, 14, y);
          y += 10;
        }
      });

      doc.save('ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø­Ø¶ÙˆØ±_ÙˆØ§Ù„ØºÙŠØ§Ø¨.pdf');
    }

    async function saveToGitHub() {
      const token = document.getElementById('token').value || localStorage.getItem('gh_token');
      if (!token) {
        showError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ GitHub Token');
        return;
      }

      createNewDataFile();

      const primaryData = Object.fromEntries(
        Object.entries(allStudentsData).filter(([_, student]) => student._file === 'students.json')
      );
      const secondaryData = Object.fromEntries(
        Object.entries(allStudentsData).filter(([_, student]) => student._file === 'students2.json')
      );

      try {
        showLoading(true);
        const files = [
          { path, data: primaryData },
          { path: secondaryPath, data: secondaryData }
        ];

        for (let file of files) {
          const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${file.path}`, {
            method: 'PUT',
            headers: {
              'Authorization': `token ${token}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              message: `ØªØ­Ø¯ÙŠØ« ${file.path}`,
              content: btoa(JSON.stringify(file.data)),
              branch,
              sha: await getFileSha(file.path, token)
            })
          });

          if (!res.ok) {
            throw new Error(`ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ ${file.path}`);
          }
        }

        localStorage.setItem('gh_token', token);
        document.getElementById('currentDataFile').textContent = currentDataFile;
        showSuccess('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
      } catch (error) {
        showError('ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message);
      } finally {
        showLoading(false);
      }
    }

    async function savePostsToGitHub() {
      const token = document.getElementById('token').value || localStorage.getItem('gh_token');
      if (!token) {
        showError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ GitHub Token');
        return;
      }

      try {
        showLoading(true);
        const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${postsPath}`, {
          method: 'PUT',
          headers: {
            'Authorization': `token ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            message: 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª',
            content: btoa(JSON.stringify(posts)),
            branch,
            sha: await getFileSha(postsPath, token)
          })
        });

        if (!res.ok) {
          throw new Error('ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª');
        }

        showSuccess('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
      } catch (error) {
        showError('ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª: ' + error.message);
      } finally {
        showLoading(false);
      }
    }

    async function saveTrashToGitHub() {
      const token = document.getElementById('token').value || localStorage.getItem('gh_token');
      if (!token) {
        showError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ GitHub Token');
        return;
      }

      try {
        showLoading(true);
        const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${trashPath}`, {
          method: 'PUT',
          headers: {
            'Authorization': `token ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            message: 'ØªØ­Ø¯ÙŠØ« Ø³Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ù„Ø§Øª',
            content: btoa(JSON.stringify(trash)),
            branch,
            sha: await getFileSha(trashPath, token)
          })
        });

        if (!res.ok) {
          throw new Error('ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø³Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ù„Ø§Øª');
        }

        showSuccess('ØªÙ… Ø­ÙØ¸ Ø³Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ù„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
      } catch (error) {
        showError('ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø³Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ù„Ø§Øª: ' + error.message);
      } finally {
        showLoading(false);
      }
    }

    async function getFileSha(filePath, token) {
      try {
        const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`, {
          headers: { 'Authorization': `token ${token}` }
        });
        if (res.ok) {
          const data = await res.json();
          return data.sha;
        }
        return null;
      } catch {
        return null;
      }
    }

    function exportData(format) {
      if (format === 'json') {
        const dataStr = JSON.stringify(students, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        saveAs(blob, 'students_data.json');
      } else if (format === 'xlsx') {
        const wsData = [['ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨', 'Ø§Ù„Ø§Ø³Ù…', 'Ø§Ù„ØµÙ', 'Ø§Ù„Ù…Ø³ØªÙˆÙ‰', 'Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±', ...months, ...weekDays]];
        for (let id in students) {
          const student = students[id];
          const row = [
            id,
            student.name,
            student.main,
            student.info || '-',
            student.phone || '-',
            ...months.map(month => student.fees[month] ? 'Ù…Ø³Ø¯Ø¯Ø©' : 'ØºÙŠØ± Ù…Ø³Ø¯Ø¯Ø©'),
            ...weekDays.map(day => student.attendance[day] || '-')
          ];
          wsData.push(row);
        }
        const ws = XLSX.utils.aoa_to_sheet(wsData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'Students');
        XLSX.writeFile(wb, 'students_data.xlsx');
      }
    }

    function showSuccess(message) {
      Swal.fire({
        title: 'Ù†Ø¬Ø§Ø­',
        text: message,
        icon: 'success',
        confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
      });
    }

    function showError(message) {
      Swal.fire({
        title: 'Ø®Ø·Ø£',
        text: message,
        icon: 'error',
        confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
      });
    }

    function showLoading(show) {
      if (show) {
        document.querySelectorAll('.btn').forEach(btn => {
          if (!btn.disabled) {
            btn.disabled = true;
            originalButtonText = btn.innerHTML;
            btn.innerHTML = '<span class="spinner"></span> Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
          }
        });
      } else {
        document.querySelectorAll('.btn').forEach(btn => {
          btn.disabled = false;
          btn.innerHTML = originalButtonText;
        });
      }
      isLoading = show;
    }

    function closeModal() {
      document.querySelectorAll('.modal').forEach(modal => modal.style.display = 'none');
      currentStudentId = null;
      deleteStudentId = null;
      studentImageFile = null;
    }

    function closePostModal() {
      document.getElementById('postModal').style.display = 'none';
      currentPostId = null;
      postImageFile = null;
    }

    function hideAllStudents() {
      students = {};
      renderStudentCards();
    }

    document.getElementById('themeToggle').addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      const themeToggle = document.getElementById('themeToggle');
      themeToggle.classList.toggle('active');
    });

    if (localStorage.getItem('isLoggedIn') === 'true') {
      document.getElementById('loginScreen').style.display = 'none';
      loadAllStudentsData();
      loadPosts();
      loadTrash();
      fillGradeSelects();
      const today = new Date();
      document.getElementById('currentDate').textContent = today.toLocaleDateString('ar-EG');
    }

    window.addEventListener('click', (event) => {
      const sidebar = document.getElementById('sidebar');
      const toggle = document.querySelector('.sidebar-toggle');
      if (!sidebar.contains(event.target) && !toggle.contains(event.target) && sidebar.classList.contains('open')) {
        sidebar.classList.remove('open');
      }
    });
  </script>
</body>
<html>
