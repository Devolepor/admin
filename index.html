<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #1976d2;
      --primary-dark: #125ea5;
      --danger-color: #e53935;
      --warning-color: #ff9800;
      --success-color: #43a047;
      --text-color: #2d3748;
      --text-light: #4a5568;
      --light-bg: #f8fafc;
      --white: #ffffff;
      --gray-light: #e2e8f0;
      --gray-dark: #cbd5e0;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --radius: 12px;
      --transition: all 0.3s ease;
    }

    /* Dark Mode Variables */
    .dark-mode {
      --primary-color: #4299e1;
      --primary-dark: #3182ce;
      --danger-color: #fc8181;
      --warning-color: #f6ad55;
      --success-color: #68d391;
      --text-color: #e2e8f0;
      --text-light: #a0aec0;
      --light-bg: #1a202c;
      --white: #2d3748;
      --gray-light: #4a5568;
      --gray-dark: #2d3748;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Tajawal', sans-serif;
      background-color: var(--light-bg);
      color: var(--text-color);
      line-height: 1.6;
      padding: 0;
      margin: 0;
      min-height: 100vh;
      transition: var(--transition);
    }
    
    .container {
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 15px 0;
      border-bottom: 1px solid var(--gray-light);
    }
    
    .header h1 {
      color: var(--primary-color);
      font-size: 28px;
      font-weight: 700;
      margin: 10px 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .header-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .grade-select {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    input, button, select, textarea {
      padding: 12px 15px;
      border-radius: var(--radius);
      border: 1px solid var(--gray-light);
      font-family: 'Tajawal', sans-serif;
      font-size: 16px;
      transition: var(--transition);
      width: 100%;
      background-color: var(--white);
      color: var(--text-color);
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2);
    }
    
    .control-panel {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--white);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      overflow: hidden;
      margin-bottom: 30px;
    }
    
    th, td {
      border: 1px solid var(--gray-light);
      padding: 12px 15px;
      text-align: center;
      font-size: 15px;
    }
    
    th {
      background-color: var(--primary-color);
      color: var(--white);
      font-weight: 500;
    }
    
    tr:nth-child(even) {
      background-color: rgba(0, 0, 0, 0.02);
    }
    
    tr:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }
    
    .btn {
      background-color: var(--primary-color);
      color: var(--white);
      border: none;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      white-space: nowrap;
      transition: var(--transition);
    }
    
    .btn:hover {
      background-color: var(--primary-dark);
      transform: translateY(-1px);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .btn-danger {
      background-color: var(--danger-color);
    }
    
    .btn-danger:hover {
      background-color: #c62828;
    }
    
    .btn-success {
      background-color: var(--success-color);
    }
    
    .btn-success:hover {
      background-color: #2e7d32;
    }
    
    .btn-warning {
      background-color: var(--warning-color);
    }
    
    .btn-warning:hover {
      background-color: #e65100;
    }
    
    .login-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--white) 0%, var(--light-bg) 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    
    .login-box {
      background: var(--white);
      padding: 40px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      width: 90%;
      max-width: 400px;
      text-align: center;
    }
    
    .login-box h2 {
      margin-bottom: 25px;
      color: var(--primary-color);
      font-size: 24px;
    }
    
    .login-box input {
      margin-bottom: 20px;
    }
    
    #studentsCount {
      text-align: center;
      font-weight: bold;
      margin: 20px 0;
      color: var(--text-color);
      font-size: 18px;
      background: var(--white);
      padding: 15px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      backdrop-filter: blur(3px);
    }
    
    .modal-content {
      background-color: var(--white);
      margin: 5% auto;
      padding: 25px;
      border-radius: var(--radius);
      width: 90%;
      max-width: 600px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      position: relative;
      bottom: 80px;
    }
    
    .close {
      color: var(--text-light);
      position: absolute;
      right: 20px;
      top: 15px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .close:hover {
      color: var(--text-color);
    }
    
    .modal-body {
      padding: 20px 0;
    }
    
    .modal-footer {
      text-align: left;
      padding-top: 20px;
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }
    
    .modal-title {
      margin-top: 0;
      color: var(--primary-color);
      font-size: 22px;
      margin-bottom: 20px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text-color);
    }
    
    .attendance-select, .fee-checkbox {
      margin: 5px 0;
    }
    
    /* Dark mode toggle */
    .theme-toggle {
      background: none;
      border: none;
      font-size: 24px;
      color: var(--text-color);
      cursor: pointer;
      padding: 5px;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
    }
    
    .theme-toggle:hover {
      background-color: rgba(0,0,0,0.1);
    }
    
    /* Export dropdown */
    .export-dropdown {
      position: relative;
      display: inline-block;
    }
    
    .export-btn {
      background-color: var(--warning-color);
    }
    
    .export-btn:hover {
      background-color: #e65100;
    }
    
    .export-content {
      display: none;
      position: absolute;
      background-color: var(--white);
      min-width: 160px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 1;
      border-radius: var(--radius);
      overflow: hidden;
      right: 0;
      margin-top: 5px;
    }
    
    .export-content a {
      color: var(--text-color);
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      text-align: right;
      transition: var(--transition);
    }
    
    .export-content a:hover {
      background-color: var(--gray-light);
    }
    
    .export-dropdown:hover .export-content {
      display: block;
    }
    
    /* Social Share Buttons */
    .share-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .share-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 15px;
      border-radius: 5px;
      color: white;
      text-decoration: none;
      font-weight: 500;
      transition: var(--transition);
      min-width: 120px;
    }
    
    .share-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .share-btn i {
      margin-left: 5px;
    }
    
    .facebook {
      background-color: #3b5998;
    }
    
    .whatsapp {
      background-color: #25D366;
    }
    
    .telegram {
      background-color: #0088cc;
    }
    
    .twitter {
      background-color: #1DA1F2;
    }
    
    .link {
      background-color: var(--primary-color);
    }
    
    /* Ø£Ù†Ù…Ø§Ø· Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª */
    .posts-container {
      margin-top: 40px;
      border-top: 2px solid var(--gray-light);
      padding-top: 30px;
    }
    
    .posts-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .post-form {
      background: var(--white);
      padding: 20px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 30px;
    }
    
    .post-form textarea {
      width: 100%;
      padding: 15px;
      border-radius: var(--radius);
      border: 1px solid var(--gray-light);
      font-family: 'Tajawal', sans-serif;
      font-size: 16px;
      margin-bottom: 15px;
      resize: vertical;
      min-height: 100px;
      background-color: var(--white);
      color: var(--text-color);
    }
    
    .post {
      background: var(--white);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
      margin-bottom: 20px;
      position: relative;
    }
    
    .post-header {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .post-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background-color: var(--primary-color);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      margin-left: 15px;
    }
    
    .post-author {
      font-weight: bold;
    }
    
    .post-date {
      color: var(--text-light);
      font-size: 14px;
    }
    
    .post-content {
      margin-bottom: 15px;
      line-height: 1.6;
    }
    
    .post-image {
      max-width: 150px;
      max-height: 150px;
      border-radius: 8px;
      margin: 10px 0;
      display: block;
      cursor: pointer;
      transition: transform 0.3s;
    }
    
    .post-image:hover {
      transform: scale(1.5);
      z-index: 10;
      position: relative;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    
    .post-actions {
      display: flex;
      gap: 15px;
      border-top: 1px solid var(--gray-light);
      padding-top: 15px;
      flex-wrap: wrap;
    }
    
    .post-action {
      display: flex;
      align-items: center;
      gap: 5px;
      color: var(--text-light);
      cursor: pointer;
      transition: var(--transition);
      padding: 8px 12px;
      border-radius: 20px;
      background-color: var(--light-bg);
    }
    
    .post-action:hover {
      color: var(--primary-color);
      background-color: rgba(25, 118, 210, 0.1);
    }
    
    .post-action.liked {
      color: var(--danger-color);
      background-color: rgba(229, 57, 53, 0.1);
    }
    
    .post-delete {
      position: absolute;
      top: 15px;
      left: 15px;
      color: var(--danger-color);
      cursor: pointer;
      opacity: 0.7;
      transition: var(--transition);
    }
    
    .post-delete:hover {
      opacity: 1;
    }
    
    .tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--gray-light);
    }
    
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: var(--transition);
    }
    
    .tab.active {
      border-bottom-color: var(--primary-color);
      color: var(--primary-color);
      font-weight: bold;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }

    /* Ø£Ù†Ù…Ø§Ø· Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª */
    .notes-section {
      background: var(--white);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .notes-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--gray-light);
    }
    
    .notes-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--primary-color);
    }
    
    .notes-content {
      min-height: 100px;
      padding: 10px;
      border: 1px solid var(--gray-light);
      border-radius: var(--radius);
      background-color: var(--white);
      color: var(--text-color);
    }
    
    .notes-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 15px;
    }

    /* Ø£Ù†Ù…Ø§Ø· Ø¬Ø¯ÙŠØ¯Ø© Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ */
    .add-student-section {
      background: var(--white);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
      margin-bottom: 30px;
    }
    
    .add-student-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--gray-light);
    }
    
    .add-student-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--primary-color);
    }
    
    .add-student-form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
    }
    
    .form-actions {
      grid-column: 1 / -1;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 10px;
    }

    /* Ø£Ù†Ù…Ø§Ø· Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ± */
    .image-upload {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 15px;
    }
    
    .image-preview {
      max-width: 150px;
      max-height: 150px;
      border-radius: 8px;
      display: none;
      cursor: pointer;
    }
    
    .upload-btn {
      position: relative;
      overflow: hidden;
      display: inline-block;
    }
    
    .upload-btn input[type="file"] {
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }

    /* Ù†Ù…Ø· Ù„Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ù„Ø­Ø¬Ù… Ø§Ù„ÙƒØ§Ù…Ù„ */
    .image-modal {
      display: none;
      position: fixed;
      z-index: 1001;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.9);
      text-align: center;
    }
    
    .image-modal-content {
      max-width: 90%;
      max-height: 90%;
      margin: auto;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    
    .close-image {
      position: absolute;
      top: 20px;
      right: 30px;
      color: white;
      font-size: 35px;
      font-weight: bold;
      cursor: pointer;
    }

    /* Ø£Ù†Ù…Ø§Ø· Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ© */
    .share-image-container {
      text-align: center;
      margin: 15px 0;
    }
    
    .share-image {
      max-width: 100%;
      border-radius: 8px;
      border: 1px solid var(--gray-light);
      box-shadow: var(--shadow);
    }

    /* Ø£Ù†Ù…Ø§Ø· Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§ØªÙ */
    .mobile-actions {
      display: none;
    }

    /* Ø£Ù†Ù…Ø§Ø· Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§ØªÙ */
    .student-card {
      background: var(--white);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 15px;
      margin-bottom: 15px;
      transition: var(--transition);
    }
    
    .student-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    }
    
    .student-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--gray-light);
    }
    
    .student-id {
      font-weight: bold;
      color: var(--primary-color);
      font-size: 16px;
    }
    
    .student-name {
      font-weight: bold;
      font-size: 18px;
    }
    
    .student-grade {
      color: var(--text-light);
      font-size: 14px;
    }
    
    .student-level {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
      margin-top: 5px;
    }
    
    .level-weak {
      background-color: #ffebee;
      color: #c62828;
    }
    
    .level-acceptable {
      background-color: #fff8e1;
      color: #e65100;
    }
    
    .level-good {
      background-color: #e8f5e9;
      color: #2e7d32;
    }
    
    .level-very-good {
      background-color: #e3f2fd;
      color: #1565c0;
    }
    
    .level-excellent {
      background-color: #f3e5f5;
      color: #6a1b9a;
    }
    
    .student-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    
    .student-actions .btn {
      flex: 1;
      padding: 8px;
      font-size: 14px;
    }
    
    .student-details {
      display: none;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid var(--gray-light);
    }
    
    .student-details.active {
      display: block;
    }
    
    .details-section {
      margin-bottom: 15px;
    }
    
    .details-title {
      font-weight: bold;
      margin-bottom: 8px;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .attendance-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }
    
    .attendance-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 5px;
      background: var(--light-bg);
      border-radius: 5px;
    }
    
    .fees-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }
    
    .fee-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 5px;
      background: var(--light-bg);
      border-radius: 5px;
    }
    
    .notes-content {
      background: var(--light-bg);
      padding: 10px;
      border-radius: 5px;
      min-height: 50px;
    }

    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .header-actions {
        width: 100%;
      }
      
      .grade-select {
        width: 100%;
      }
      
      .grade-select button {
        width: 100%;
      }
      
      .modal-content {
        width: 95%;
        margin: 10% auto;
      }
      
      table {
        display: none;
      }
      
      #studentsTable {
        display: block;
      }
      
      .control-panel {
        grid-template-columns: 1fr;
      }
      
      .export-content {
        right: auto;
        left: 0;
      }
      
      .share-buttons {
        flex-direction: column;
        align-items: center;
      }
      
      .share-btn {
        width: 100%;
      }

      .posts-header {
        flex-direction: column;
        gap: 15px;
      }

      .post-actions {
        flex-direction: column;
        gap: 10px;
      }
      
      .add-student-form {
        grid-template-columns: 1fr;
      }
      
      .post-image {
        max-width: 100%;
        max-height: 200px;
      }

      /* Ø¥Ø¸Ù‡Ø§Ø± Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‡Ø§ØªÙ */
      .mobile-actions {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }

      .desktop-actions {
        display: none;
      }
      
      /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§ØªÙ */
      .student-card {
        padding: 12px;
      }
      
      .student-name {
        font-size: 16px;
      }
      
      .student-id {
        font-size: 14px;
      }
      
      .student-actions .btn {
        font-size: 12px;
        padding: 6px;
      }
      
      .attendance-grid,
      .fees-grid {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 480px) {
      .login-box {
        padding: 30px 20px;
      }
      
      .modal-footer {
        flex-direction: column;
      }
      
      .modal-footer button {
        width: 100%;
      }

      .tabs {
        flex-direction: column;
      }

      .tab {
        text-align: center;
      }
      
      .form-actions {
        flex-direction: column;
      }
      
      .form-actions button {
        width: 100%;
      }
      
      .post-image {
        max-width: 100%;
        max-height: 150px;
      }
      
      .student-actions {
        flex-direction: column;
        gap: 8px;
      }
      
      .student-actions .btn {
        width: 100%;
      }
    }
    
    /* Loading spinner */
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: var(--white);
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Scrollbar styling */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: var(--gray-light);
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary-dark);
    }
  </style>
</head>
<body>
  <!-- Modal Ù„Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ù„Ø­Ø¬Ù… Ø§Ù„ÙƒØ§Ù…Ù„ -->
  <div id="imageModal" class="image-modal">
    <span class="close-image" onclick="closeImageModal()">&times;</span>
    <img class="image-modal-content" id="expandedImage">
  </div>

  <div class="login-screen" id="loginScreen">
    <div class="login-box">
      <h2><i class="fas fa-lock"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
      <input type="password" id="loginPassword" placeholder="Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
      <button class="btn btn-success" onclick="checkLogin()"><i class="fas fa-sign-in-alt"></i> Ø¯Ø®ÙˆÙ„</button>
    </div>
  </div>

  <div class="container">
    <!-- Modal for Add/Edit Student -->
    <div id="studentModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h3 class="modal-title" id="modalTitle"><i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</h3>
        <div class="modal-body">
          <div class="form-group">
            <label for="studentId"><i class="fas fa-id-card"></i> ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨</label>
            <input type="text" id="studentId" placeholder="Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹" disabled>
          </div>
          <div class="form-group">
            <label for="studentName"><i class="fas fa-user"></i> Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</label>
            <input type="text" id="studentName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">
          </div>
          <div class="form-group">
            <label for="studentGrade"><i class="fas fa-graduation-cap"></i> Ø§Ù„ØµÙ</label>
            <select id="studentGrade">
              <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
            </select>
          </div>
          <div class="form-group">
            <label for="studentLevel"><i class="fas fa-star"></i> Ø§Ù„Ù…Ø³ØªÙˆÙ‰</label>
            <select id="studentLevel">
              <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰</option>
              <option value="Ø¶Ø¹ÙŠÙ">Ø¶Ø¹ÙŠÙ</option>
              <option value="Ù…Ù‚Ø¨ÙˆÙ„">Ù…Ù‚Ø¨ÙˆÙ„</option>
              <option value="Ø¬ÙŠØ¯">Ø¬ÙŠØ¯</option>
              <option value="Ø¬ÙŠØ¯ Ø¬Ø¯Ø§">Ø¬ÙŠØ¯ Ø¬Ø¯Ø§</option>
              <option value="Ù…Ù…ØªØ§Ø²">Ù…Ù…ØªØ§Ø²</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn" onclick="closeModal()"><i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡</button>
          <button class="btn btn-success" id="saveStudentBtn"><i class="fas fa-save"></i> Ø­ÙØ¸</button>
        </div>
      </div>
    </div>

    <!-- Modal for Grade Selection -->
    <div id="gradeModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h3 class="modal-title"><i class="fas fa-filter"></i> Ø§Ø®ØªØ± Ø§Ù„ØµÙ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
        <div class="modal-body">
          <select id="gradeSelect">
            <option value="">Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨</option>
          </select>
        </div>
        <div class="modal-footer">
          <button class="btn" onclick="closeModal()"><i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡</button>
          <button class="btn" onclick="filterByGrade()"><i class="fas fa-eye"></i> Ø¹Ø±Ø¶</button>
        </div>
      </div>
    </div>

    <!-- Modal for Delete Confirmation -->
    <div id="deleteModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h3 class="modal-title"><i class="fas fa-trash-alt"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h3>
        <div class="modal-body">
          <p id="deleteMessage">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ</p>
        </div>
        <div class="modal-footer">
          <button class="btn" onclick="closeModal()"><i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡</button>
          <button class="btn btn-danger" onclick="confirmDelete()"><i class="fas fa-trash"></i> Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù</button>
        </div>
      </div>
    </div>

    <!-- Modal for Add/Edit Post -->
    <div id="postModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closePostModal()">&times;</span>
        <h3 class="modal-title" id="postModalTitle"><i class="fas fa-plus"></i> Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯</h3>
        <div class="modal-body">
          <div class="form-group">
            <label for="editPostTitle"><i class="fas fa-heading"></i> Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù†Ø´ÙˆØ±</label>
            <input type="text" id="editPostTitle" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù†Ø´ÙˆØ±">
          </div>
          <div class="form-group">
            <label for="editPostContent"><i class="fas fa-align-left"></i> Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</label>
            <textarea id="editPostContent" placeholder="Ø§ÙƒØªØ¨ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ù‡Ù†Ø§..." rows="6"></textarea>
          </div>
          <div class="form-group">
            <label><i class="fas fa-image"></i> ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†Ø´ÙˆØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <div class="image-upload">
              <button class="btn upload-btn">
                <i class="fas fa-upload"></i> Ø§Ø®ØªØ± ØµÙˆØ±Ø©
                <input type="file" id="postImageInput" accept="image/*" onchange="previewPostImage()">
              </button>
              <img id="postImagePreview" class="image-preview" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©" onclick="expandImage(this)">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn" onclick="closePostModal()"><i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡</button>
          <button class="btn btn-success" id="savePostBtn"><i class="fas fa-save"></i> Ø­ÙØ¸</button>
        </div>
      </div>
    </div>
    
    <!-- Modal for Edit Notes -->
    <div id="notesModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h3 class="modal-title"><i class="fas fa-sticky-note"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h3>
        <div class="modal-body">
          <div class="form-group">
            <label for="notesContent"><i class="fas fa-edit"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</label>
            <textarea id="notesContent" rows="6" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ù† Ø§Ù„Ø·Ø§Ù„Ø¨"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn" onclick="closeModal()"><i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡</button>
          <button class="btn btn-success" onclick="saveNotes()"><i class="fas fa-save"></i> Ø­ÙØ¸</button>
        </div>
      </div>
    </div>

    <div class="header">
      <h1><i class="fas fa-user-graduate"></i> Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</h1>
      <div class="header-actions">
        <div class="grade-select">
          <button onclick="showGradeModal()"><i class="fas fa-filter"></i> Ø§Ø®ØªØ± Ø§Ù„ØµÙ</button>
          <button onclick="renderTable()"><i class="fas fa-list"></i> Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>
        </div>
        <button class="theme-toggle" id="themeToggle" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ">
          <i class="fas fa-moon"></i>
        </button>
      </div>
    </div>

    <div class="tabs">
      <div class="tab active" onclick="switchTab('students')">
        <i class="fas fa-users"></i> Ø§Ù„Ø·Ù„Ø§Ø¨
      </div>
      <div class="tab" onclick="switchTab('posts')">
        <i class="fas fa-newspaper"></i> Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª
      </div>
    </div>

    <!-- Students Tab -->
    <div id="students-tab" class="tab-content active">
      <!-- Ù‚Ø³Ù… Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ -->
      <div class="add-student-section">
        <div class="add-student-header">
          <h2 class="add-student-title"><i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
        </div>
        <div class="add-student-form">
          <div class="form-group">
            <label for="newStudentId"><i class="fas fa-id-card"></i> ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨</label>
            <input type="text" id="newStudentId" placeholder="Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹" disabled>
          </div>
          <div class="form-group">
            <label for="newStudentName"><i class="fas fa-user"></i> Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</label>
            <input type="text" id="newStudentName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">
          </div>
          <div class="form-group">
            <label for="newStudentGrade"><i class="fas fa-graduation-cap"></i> Ø§Ù„ØµÙ</label>
            <select id="newStudentGrade">
              <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
            </select>
          </div>
          <div class="form-group">
            <label for="newStudentLevel"><i class="fas fa-star"></i> Ø§Ù„Ù…Ø³ØªÙˆÙ‰</label>
            <select id="newStudentLevel">
              <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰</option>
              <option value="Ø¶Ø¹ÙŠÙ">Ø¶Ø¹ÙŠÙ</option>
              <option value="Ù…Ù‚Ø¨ÙˆÙ„">Ù…Ù‚Ø¨ÙˆÙ„</option>
              <option value="Ø¬ÙŠØ¯">Ø¬ÙŠØ¯</option>
              <option value="Ø¬ÙŠØ¯ Ø¬Ø¯Ø§">Ø¬ÙŠØ¯ Ø¬Ø¯Ø§</option>
              <option value="Ù…Ù…ØªØ§Ø²">Ù…Ù…ØªØ§Ø²</option>
            </select>
          </div>
          <div class="form-actions">
            <button class="btn" onclick="clearAddForm()"><i class="fas fa-broom"></i> Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>
            <button class="btn btn-success" onclick="addStudentFromForm()"><i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</button>
          </div>
        </div>
      </div>
      
      <div class="control-panel">
        <input type="text" id="token" placeholder="ğŸ”‘ GitHub Token">
        <input type="text" id="searchId" placeholder="ğŸ” ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨">
        <button class="btn" onclick="searchStudent()"><i class="fas fa-search"></i> Ø¨Ø­Ø«</button>
        <button class="btn" onclick="openFile()"><i class="fas fa-folder-open"></i> ÙØªØ­ Ù…Ù„Ù</button>
        <button class="btn" onclick="saveToGitHub()"><i class="fas fa-save"></i> Ø­ÙØ¸</button>
        <div class="export-dropdown">
          <button class="btn export-btn"><i class="fas fa-file-export"></i> ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
          <div class="export-content">
            <a href="#" onclick="exportData('pdf')"><i class="fas fa-file-pdf"></i> ØªØµØ¯ÙŠØ± PDF</a>
            <a href="#" onclick="exportData('excel')"><i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ± Excel</a>
            <a href="#" onclick="exportData('word')"><i class="fas fa-file-word"></i> ØªØµØ¯ÙŠØ± Word</a>
            <a href="#" onclick="exportData('json')"><i class="fas fa-file-code"></i> ØªØµØ¯ÙŠØ± JSON</a>
          </div>
        </div>
      </div>

      <div id="studentsCount"></div>
      <div id="studentsTable"></div>
      <div id="studentsCards"></div>
    </div>

    <!-- Posts Tab -->
    <div id="posts-tab" class="tab-content">
      <div class="posts-container">
        <div class="posts-header">
          <h2><i class="fas fa-newspaper"></i> Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</h2>
          <button class="btn btn-success" onclick="showPostModal()">
            <i class="fas fa-plus"></i> Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯
          </button>
        </div>

        <div id="postsList"></div>
      </div>
    </div>
  </div>

<script>
// Initialize jsPDF
const { jsPDF } = window.jspdf;

let students = {};
let posts = {};
let sha = "";
const owner = "Devolepor";
const repo = "app";
const path = "students.json";
const postsPath = "posts.json";
const branch = "main";
const PASSWORD = "0101356859001223277310";
let githubFileUrl = `https://github.com/${owner}/${repo}/blob/${branch}/${path}`;
let currentStudentId = null;
let currentPostId = null;
let deleteStudentId = null;
let isLoading = false;
let originalButtonText = "";
let postImageFile = null;

const grades = [
  "Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ",
  "Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ",
  "Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ", "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ", "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ",
  "Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ", "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ", "Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ"
];

const levels = ["Ø¶Ø¹ÙŠÙ", "Ù…Ù‚Ø¨ÙˆÙ„", "Ø¬ÙŠØ¯", "Ø¬ÙŠØ¯ Ø¬Ø¯Ø§", "Ù…Ù…ØªØ§Ø²"];

// Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ÙˆØ£Ø´Ù‡Ø± Ø§Ù„Ø³Ù†Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
const weekDays = ["Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©"];
const months = ["Ø£ØºØ³Ø·Ø³", "Ø³Ø¨ØªÙ…Ø¨Ø±", "Ø£ÙƒØªÙˆØ¨Ø±", "Ù†ÙˆÙÙ…Ø¨Ø±", "Ø¯ÙŠØ³Ù…Ø¨Ø±", "ÙŠÙ†Ø§ÙŠØ±", "ÙØ¨Ø±Ø§ÙŠØ±", "Ù…Ø§Ø±Ø³", "Ø£Ø¨Ø±ÙŠÙ„"];

// Check for saved theme preference
if (localStorage.getItem("theme") === "dark") {
  document.body.classList.add("dark-mode");
  document.getElementById("themeToggle").innerHTML = '<i class="fas fa-sun"></i>';
}

if (localStorage.getItem("gh_token")) {
  document.getElementById("token").value = localStorage.getItem("gh_token");
}

// Theme toggle functionality
document.getElementById("themeToggle").addEventListener("click", function() {
  document.body.classList.toggle("dark-mode");
  if (document.body.classList.contains("dark-mode")) {
    localStorage.setItem("theme", "dark");
    this.innerHTML = '<i class="fas fa-sun"></i>';
  } else {
    localStorage.setItem("theme", "light");
    this.innerHTML = '<i class="fas fa-moon"></i>';
  }
});

// Ø¯Ø§Ù„Ø© Ù„ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ø·Ø§Ù„Ø¨ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù…ÙƒÙˆÙ† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…
function generateStudentId() {
  let id;
  do {
    id = Math.floor(100000 + Math.random() * 900000).toString();
  } while (students[id]); // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹
  return id;
}

function checkLogin() {
  const pass = document.getElementById("loginPassword").value;
  if (pass === PASSWORD) {
    localStorage.setItem("isLoggedIn", "true");
    document.getElementById("loginScreen").style.display = "none";
    loadStudents();
    loadPosts();
    
    // ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµÙÙˆÙ Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    fillGradeSelects();
  } else {
    Swal.fire({
      title: 'Ø®Ø·Ø£!',
      text: 'ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!',
      icon: 'error',
      confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
    });
  }
}

// ØªØ¹Ø¨Ø¦Ø© Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„ØµÙÙˆÙ ÙÙŠ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
function fillGradeSelects() {
  const gradeSelects = [
    document.getElementById('studentGrade'),
    document.getElementById('newStudentGrade'),
    document.getElementById('gradeSelect')
  ];
  
  gradeSelects.forEach(select => {
    if (select) {
      select.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>';
      grades.forEach(grade => {
        select.innerHTML += `<option value="${grade}">${grade}</option>`;
      });
    }
  });
}

async function loadStudents() {
  try {
    showLoading(true);
    let res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`);
    if (!res.ok) throw new Error('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨');
    
    let data = await res.json();
    sha = data.sha;
    let decodedContent = decodeURIComponent(escape(atob(data.content)));
    students = JSON.parse(decodedContent);
    renderTable();
    renderStudentCards();
  } catch (error) {
    console.error("Error loading students:", error);
    students = {};
    renderTable();
    renderStudentCards();
    Swal.fire({
      title: 'ØªØ­Ø°ÙŠØ±',
      text: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø§Ù„ÙŠØ© Ù„Ù„Ø·Ù„Ø§Ø¨ØŒ Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯ Ø¹Ù†Ø¯ Ø§Ù„Ø­ÙØ¸',
      icon: 'warning'
    });
  } finally {
    showLoading(false);
  }
}

async function loadPosts() {
  try {
    showLoading(true);
    let res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${postsPath}`);
    if (!res.ok) throw new Error('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª');
    
    let data = await res.json();
    let decodedContent = decodeURIComponent(escape(atob(data.content)));
    posts = JSON.parse(decodedContent);
    renderPosts();
  } catch (error) {
    console.error("Error loading posts:", error);
    posts = {};
    renderPosts();
    Swal.fire({
      title: 'ØªØ­Ø°ÙŠØ±',
      text: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø­Ø§Ù„ÙŠØ©ØŒ Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯ Ø¹Ù†Ø¯ Ø§Ù„Ø­ÙØ¸',
      icon: 'warning'
    });
  } finally {
    showLoading(false);
  }
}

function renderTable(filterGrade = null) {
  if (window.innerWidth <= 768) return; // Ù„Ø§ ØªØ¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§ØªÙ
  
  let html = `
    <div style="overflow-x: auto;">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Ø§Ù„ÙƒÙˆØ¯</th>
            <th>Ø§Ù„Ø§Ø³Ù…</th>
            <th>Ø§Ù„ØµÙ</th>
            <th>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th>
            <th>Ø§Ù„Ø­Ø¶ÙˆØ±</th>
            <th>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</th>
            <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
            <th>ØªØ¹Ø¯ÙŠÙ„</th>
            <th>Ø­Ø°Ù</th>
          </tr>
        </thead>
        <tbody>
  `;
  
  let count = 1;
  let studentCount = 0;
  
  for (let id in students) {
    let s = students[id];
    if (filterGrade && s.main.trim() !== filterGrade.trim()) continue;

    studentCount++;
    
    // ØªØ­Ø¶ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±
    let attendanceHtml = weekDays.map(day => {
      const status = s.attendance?.[day] || '-';
      return `
        <div class="attendance-select">
          ${day}: 
          <select onchange="updateAttendance('${id}','${day}',this.value)" style="padding: 5px; border-radius: 5px; background: var(--white); color: var(--text-color);">
            <option value="Ø­Ø§Ø¶Ø±" ${status === "Ø­Ø§Ø¶Ø±" ? 'selected' : ''}>Ø­Ø§Ø¶Ø±</option>
            <option value="ØºØ§Ø¦Ø¨" ${status === "ØºØ§Ø¦Ø¨" ? 'selected' : ''}>ØºØ§Ø¦Ø¨</option>
            <option value="-" ${status === "-" ? 'selected' : ''}>-</option>
          </select>
        </div>
      `;
    }).join('');
    
    // ØªØ­Ø¶ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª
    let feesHtml = months.map(month => {
      const paid = s.fees?.[month] || false;
      return `
        <div class="fee-checkbox">
          ${month}: 
          <input type="checkbox" onchange="updateFee('${id}','${month}',this.checked)" ${paid ? 'checked' : ''} 
                 style="transform: scale(1.3); margin-right: 5px;">
        </div>
      `;
    }).join('');
    
    // ØªØ­Ø¶ÙŠØ± Ù‚Ø³Ù… Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
    let notesHtml = `
      <div class="notes-section">
        <div class="notes-content">
          ${s.notes || '<span style="color: var(--text-light);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª</span>'}
        </div>
        <div class="notes-actions">
          <button class="btn" onclick="showNotesModal('${id}')">
            <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
          </button>
        </div>
      </div>
    `;
    
    html += `
      <tr>
        <td>${count++}</td>
        <td>${id}</td>
        <td>${s.name}</td>
        <td>${s.main}</td>
        <td>${s.info || '-'}</td>
        <td>${attendanceHtml}</td>
        <td>${feesHtml}</td>
        <td>${notesHtml}</td>
        <td><button class="btn" onclick="showEditModal('${id}')"><i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„</button></td>
        <td><button class="btn btn-danger" onclick="showDeleteModal('${id}')"><i class="fas fa-trash"></i> Ø­Ø°Ù</button></td>
      </tr>
    `;
  }
  
  html += `
        </tbody>
      </table>
    </div>
  `;
  
  document.getElementById('studentsTable').innerHTML = studentCount > 0 ? html : `
    <div style="text-align: center; padding: 40px; background: var(--white); border-radius: 12px; box-shadow: var(--shadow);">
      <h3 style="color: var(--text-light);"><i class="fas fa-info-circle"></i> Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù…Ø³Ø¬Ù„ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
    </div>
  `;
  
  document.getElementById('studentsCount').innerHTML = `
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <span><i class="fas fa-users"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶ÙŠÙ†: ${studentCount}</span>
      <span><i class="fas fa-calendar-alt"></i> ${new Date().toLocaleDateString('ar-EG')}</span>
    </div>
  `;
}

function renderStudentCards(filterGrade = null) {
  if (window.innerWidth > 768) {
    document.getElementById('studentsCards').innerHTML = '';
    return;
  }
  
  let html = '';
  let studentCount = 0;
  
  for (let id in students) {
    let s = students[id];
    if (filterGrade && s.main.trim() !== filterGrade.trim()) continue;

    studentCount++;
    
    // ØªØ­Ø¯ÙŠØ¯ ÙØ¦Ø© Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ø±Ø¶
    let levelClass = '';
    if (s.info === "Ø¶Ø¹ÙŠÙ") levelClass = "level-weak";
    else if (s.info === "Ù…Ù‚Ø¨ÙˆÙ„") levelClass = "level-acceptable";
    else if (s.info === "Ø¬ÙŠØ¯") levelClass = "level-good";
    else if (s.info === "Ø¬ÙŠØ¯ Ø¬Ø¯Ø§") levelClass = "level-very-good";
    else if (s.info === "Ù…Ù…ØªØ§Ø²") levelClass = "level-excellent";
    
    html += `
      <div class="student-card" id="student-card-${id}">
        <div class="student-header" onclick="toggleStudentDetails('${id}')">
          <div>
            <div class="student-name">${s.name}</div>
            <div class="student-id">ÙƒÙˆØ¯: ${id}</div>
          </div>
          <div>
            <div class="student-grade">${s.main}</div>
            ${s.info ? `<span class="student-level ${levelClass}">${s.info}</span>` : ''}
          </div>
        </div>
        
        <div class="student-details" id="details-${id}">
          <div class="details-section">
            <div class="details-title"><i class="fas fa-calendar-check"></i> Ø§Ù„Ø­Ø¶ÙˆØ±</div>
            <div class="attendance-grid">
              ${weekDays.map(day => `
                <div class="attendance-item">
                  <span>${day}</span>
                  <select onchange="updateAttendance('${id}','${day}',this.value)" 
                          style="padding: 3px; border-radius: 5px; background: var(--white); color: var(--text-color);">
                    <option value="Ø­Ø§Ø¶Ø±" ${s.attendance?.[day] === "Ø­Ø§Ø¶Ø±" ? 'selected' : ''}>Ø­Ø§Ø¶Ø±</option>
                    <option value="ØºØ§Ø¦Ø¨" ${s.attendance?.[day] === "ØºØ§Ø¦Ø¨" ? 'selected' : ''}>ØºØ§Ø¦Ø¨</option>
                    <option value="-" ${!s.attendance?.[day] || s.attendance?.[day] === "-" ? 'selected' : ''}>-</option>
                  </select>
                </div>
              `).join('')}
            </div>
          </div>
          
          <div class="details-section">
            <div class="details-title"><i class="fas fa-money-bill-wave"></i> Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>
            <div class="fees-grid">
              ${months.map(month => `
                <div class="fee-item">
                  <span>${month}</span>
                  <input type="checkbox" onchange="updateFee('${id}','${month}',this.checked)" 
                         ${s.fees?.[month] ? 'checked' : ''} style="transform: scale(1.2);">
                </div>
              `).join('')}
            </div>
          </div>
          
          <div class="details-section">
            <div class="details-title"><i class="fas fa-sticky-note"></i> Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</div>
            <div class="notes-content">
              ${s.notes || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª'}
            </div>
          </div>
          
          <div class="student-actions">
            <button class="btn" onclick="showEditModal('${id}')">
              <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
            </button>
            <button class="btn btn-danger" onclick="showDeleteModal('${id}')">
              <i class="fas fa-trash"></i> Ø­Ø°Ù
            </button>
            <button class="btn btn-success" onclick="showNotesModal('${id}')">
              <i class="fas fa-edit"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª
            </button>
          </div>
        </div>
      </div>
    `;
  }
  
  document.getElementById('studentsCards').innerHTML = studentCount > 0 ? html : `
    <div style="text-align: center; padding: 40px; background: var(--white); border-radius: 12px; box-shadow: var(--shadow);">
      <h3 style="color: var(--text-light);"><i class="fas fa-info-circle"></i> Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù…Ø³Ø¬Ù„ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
    </div>
  `;
  
  document.getElementById('studentsCount').innerHTML = `
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <span><i class="fas fa-users"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶ÙŠÙ†: ${studentCount}</span>
      <span><i class="fas fa-calendar-alt"></i> ${new Date().toLocaleDateString('ar-EG')}</span>
    </div>
  `;
}

function toggleStudentDetails(id) {
  const details = document.getElementById(`details-${id}`);
  details.classList.toggle('active');
  
  // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ø®Ø±Ù‰ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØªÙˆØ­Ø©
  document.querySelectorAll('.student-details').forEach(detail => {
    if (detail.id !== `details-${id}` && detail.classList.contains('active')) {
      detail.classList.remove('active');
    }
  });
}

function renderPosts() {
  const postsList = document.getElementById('postsList');
  postsList.innerHTML = '';
  
  if (Object.keys(posts).length === 0) {
    postsList.innerHTML = `
      <div style="text-align: center; padding: 40px; background: var(--white); border-radius: 12px; box-shadow: var(--shadow);">
        <h3 style="color: var(--text-light);"><i class="fas fa-info-circle"></i> Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
      </div>
    `;
    return;
  }
  
  // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù…
  const sortedPosts = Object.entries(posts).sort((a, b) => new Date(b[1].date) - new Date(a[1].date));
  
  sortedPosts.forEach(([id, post]) => {
    const postElement = document.createElement('div');
    postElement.className = 'post';
    
    let imageHtml = '';
    if (post.image) {
      imageHtml = `<img src="${post.image}" class="post-image" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†Ø´ÙˆØ±" onclick="expandImage(this)">`;
    }
    
    postElement.innerHTML = `
      <div class="post-delete" onclick="deletePost('${id}')">
        <i class="fas fa-trash"></i>
      </div>
      <div class="post-header">
        <div class="post-avatar">
          <i class="fas fa-user"></i>
        </div>
        <div>
          <div class="post-author">${post.author}</div>
          <div class="post-date">${post.date}</div>
        </div>
      </div>
      <div class="post-content">
        <h3>${post.title}</h3>
        <p>${post.content.replace(/\n/g, '<br>')}</p>
        ${imageHtml}
      </div>
      <div class="post-actions">
        <div class="post-action ${post.likedBy && post.likedBy.includes('admin') ? 'liked' : ''}" 
             onclick="toggleLike('${id}')">
          <i class="fas fa-heart"></i>
          <span>${post.likes || 0} Ø¥Ø¹Ø¬Ø§Ø¨</span>
        </div>
        <div class="post-action" onclick="sharePost('${id}')">
          <i class="fas fa-share"></i>
          <span>${post.shares || 0} Ù…Ø´Ø§Ø±ÙƒØ©</span>
        </div>
        <div class="post-action" onclick="showPostModal('${id}')">
          <i class="fas fa-edit"></i>
          <span>ØªØ¹Ø¯ÙŠÙ„</span>
        </div>
      </div>
      <div class="mobile-actions">
        <button class="btn" onclick="toggleLike('${id}')">
          <i class="fas fa-heart"></i> Ø¥Ø¹Ø¬Ø§Ø¨ (${post.likes || 0})
        </button>
        <button class="btn" onclick="sharePost('${id}')">
          <i class="fas fa-share"></i> Ù…Ø´Ø§Ø±ÙƒØ©
        </button>
        <button class="btn" onclick="showPostModal('${id}')">
          <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
        </button>
      </div>
    `;
    postsList.appendChild(postElement);
  });
}

function updateAttendance(id, day, value) {
  if (!students[id].attendance) {
    students[id].attendance = {};
  }
  students[id].attendance[day] = value;
}

function updateFee(id, month, value) {
  if (!students[id].fees) {
    students[id].fees = {};
  }
  students[id].fees[month] = value;
}

function searchStudent() {
  const id = document.getElementById('searchId').value.trim();
  if (!id) {
    Swal.fire({
      title: 'ØªÙ†Ø¨ÙŠÙ‡',
      text: 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù„Ù„Ø¨Ø­Ø«',
      icon: 'warning'
    });
    return;
  }

  if (students[id]) {
    const student = students[id];
    let attendanceList = weekDays.map(day => 
      `<li>${day}: ${student.attendance?.[day] || '-'}</li>`
    ).join('');
    
    let feesList = months.map(month => 
      `<li>${month}: ${student.fees?.[month] ? 'âœ… Ù…Ø³Ø¯Ø¯Ø©' : 'âŒ ØºÙŠØ± Ù…Ø³Ø¯Ø¯Ø©'}</li>`
    ).join('');
    
    let notesHtml = student.notes ? `
      <hr>
      <h4><i class="fas fa-sticky-note"></i> Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</h4>
      <div style="background: var(--light-bg); padding: 10px; border-radius: 8px;">
        ${student.notes}
      </div>
    ` : '';
    
    Swal.fire({
      title: 'ğŸ“„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨',
      html: `
        <div style="text-align: right;">
          <p><b><i class="fas fa-id-card"></i> Ø§Ù„ÙƒÙˆØ¯:</b> ${id}</p>
          <p><b><i class="fas fa-user"></i> Ø§Ù„Ø§Ø³Ù…:</b> ${student.name}</p>
          <p><b><i class="fas fa-graduation-cap"></i> Ø§Ù„ØµÙ:</b> ${student.main}</p>
          <p><b><i class="fas fa-star"></i> Ø§Ù„Ù…Ø³ØªÙˆÙ‰:</b> ${student.info || '-'}</p>
          <hr>
          <h4><i class="fas fa-calendar-check"></i> Ø§Ù„Ø­Ø¶ÙˆØ±:</h4>
          <ul>${attendanceList}</ul>
          <h4><i class="fas fa-money-bill-wave"></i> Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª:</h4>
          <ul>${feesList}</ul>
          ${notesHtml}
        </div>
      `,
      confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹',
      width: '600px'
    });
    
    // Highlight the student card if on mobile
    if (window.innerWidth <= 768) {
      const card = document.getElementById(`student-card-${id}`);
      if (card) {
        card.scrollIntoView({ behavior: 'smooth' });
        card.style.boxShadow = '0 0 0 3px var(--primary-color)';
        setTimeout(() => {
          card.style.boxShadow = 'var(--shadow)';
        }, 2000);
      }
    }
  } else {
    Swal.fire({
      title: 'âš ï¸ ØªÙ†Ø¨ÙŠÙ‡',
      text: 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§Ù„Ø¨',
      confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
    });
  }
}

function openFile() {
  window.open(githubFileUrl, '_blank');
}

function showGradeModal() {
  const gradeSelect = document.getElementById('gradeSelect');
  gradeSelect.innerHTML = '<option value="">Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨</option>';
  grades.forEach(grade => {
    gradeSelect.innerHTML += `<option value="${grade}">${grade}</option>`;
  });
  document.getElementById('gradeModal').style.display = 'block';
}

function filterByGrade() {
  const gradeSelect = document.getElementById('gradeSelect');
  const selectedGrade = gradeSelect.value;
  renderTable(selectedGrade);
  renderStudentCards(selectedGrade);
  closeModal();
}

function showAddModal() {
  currentStudentId = null;
  document.getElementById('modalTitle').innerHTML = '<i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯';
  
  // ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙˆØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø­Ù‚Ù„
  const studentIdField = document.getElementById('studentId');
  studentIdField.value = generateStudentId();
  studentIdField.disabled = true;
  
  document.getElementById('studentName').value = '';
  document.getElementById('studentLevel').value = '';
  
  const gradeSelect = document.getElementById('studentGrade');
  gradeSelect.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>';
  grades.forEach(grade => {
    gradeSelect.innerHTML += `<option value="${grade}">${grade}</option>`;
  });
  
  document.getElementById('saveStudentBtn').onclick = saveStudent;
  document.getElementById('studentModal').style.display = 'block';
  
  // Focus Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ø§Ø³Ù…
  setTimeout(() => {
    document.getElementById('studentName').focus();
  }, 100);
}

function showEditModal(id) {
  currentStudentId = id;
  const student = students[id];
  
  document.getElementById('modalTitle').innerHTML = `<i class="fas fa-user-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ ${id}`;
  
  // ØªÙ…ÙƒÙŠÙ† Ø­Ù‚Ù„ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
  const studentIdField = document.getElementById('studentId');
  studentIdField.value = id;
  studentIdField.disabled = false;
  
  document.getElementById('studentName').value = student.name;
  
  const gradeSelect = document.getElementById('studentGrade');
  gradeSelect.innerHTML = '';
  grades.forEach(grade => {
    gradeSelect.innerHTML += `<option value="${grade}" ${grade === student.main ? 'selected' : ''}>${grade}</option>`;
  });
  
  const levelSelect = document.getElementById('studentLevel');
  levelSelect.innerHTML = '<option value="" disabled>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰</option>';
  levels.forEach(level => {
    levelSelect.innerHTML += `<option value="${level}" ${level === student.info ? 'selected' : ''}>${level}</option>`;
  });
  
  document.getElementById('saveStudentBtn').onclick = saveStudent;
  document.getElementById('studentModal').style.display = 'block';
}

function showNotesModal(id) {
  currentStudentId = id;
  const student = students[id];
  
  document.getElementById('notesContent').value = student.notes || '';
  document.getElementById('notesModal').style.display = 'block';
}

function saveNotes() {
  const notes = document.getElementById('notesContent').value.trim();
  if (currentStudentId) {
    students[currentStudentId].notes = notes;
    renderTable();
    renderStudentCards();
    closeModal();
    showSuccess('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
  }
}

function showDeleteModal(id) {
  deleteStudentId = id;
  const student = students[id];
  document.getElementById('deleteMessage').innerHTML = `
    <p>Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ØªØ§Ù„ÙŠØŸ</p>
    <div style="background: var(--gray-light); padding: 10px; border-radius: 8px; margin-top: 10px;">
      <p><strong><i class="fas fa-id-card"></i> Ø§Ù„ÙƒÙˆØ¯:</strong> ${id}</p>
      <p><strong><i class="fas fa-user"></i> Ø§Ù„Ø§Ø³Ù…:</strong> ${student.name}</p>
      <p><strong><i class="fas fa-graduation-cap"></i> Ø§Ù„ØµÙ:</strong> ${student.main}</p>
    </div>
    <p style="color: var(--danger-color); margin-top: 10px;"><i class="fas fa-exclamation-triangle"></i> Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!</p>
  `;
  document.getElementById('deleteModal').style.display = 'block';
}

function closeModal() {
  document.getElementById('studentModal').style.display = 'none';
  document.getElementById('gradeModal').style.display = 'none';
  document.getElementById('deleteModal').style.display = 'none';
  document.getElementById('notesModal').style.display = 'none';
}

function closePostModal() {
  document.getElementById('postModal').style.display = 'none';
}

function closeImageModal() {
  document.getElementById('imageModal').style.display = 'none';
}

function expandImage(img) {
  const modal = document.getElementById('imageModal');
  const modalImg = document.getElementById('expandedImage');
  modal.style.display = 'block';
  modalImg.src = img.src;
}

function addStudentFromForm() {
  const id = generateStudentId();
  const name = document.getElementById('newStudentName').value.trim();
  const grade = document.getElementById('newStudentGrade').value;
  const level = document.getElementById('newStudentLevel').value;
  
  if (!name) {
    showError('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨');
    document.getElementById('newStudentName').focus();
    return;
  }
  
  if (!grade) {
    showError('ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ');
    document.getElementById('newStudentGrade').focus();
    return;
  }
  
  // Add new student
  students[id] = {
    name,
    main: grade,
    info: level,
    notes: '',
    attendance: Object.fromEntries(weekDays.map(day => [day, "-"])),
    fees: Object.fromEntries(months.map(month => [month, false]))
  };
  
  // Capture the UI to share as image
  captureStudentUI(id, name, grade, level);
  
  renderTable();
  renderStudentCards();
  clearAddForm();
}

async function captureStudentUI(id, name, grade, level) {
  try {
    // Create a temporary element to capture
    const tempDiv = document.createElement('div');
    tempDiv.style.position = 'fixed';
    tempDiv.style.left = '-9999px';
    tempDiv.style.padding = '15px';
    tempDiv.style.backgroundColor = 'linear-gradient(to right, #ff758c, #ff7eb3);';
    tempDiv.style.borderRadius = '10px';
    tempDiv.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)';
    tempDiv.style.width = '300px';
    tempDiv.style.fontFamily = "'Tajawal', sans-serif";
    
    tempDiv.innerHTML = `
      <div style="text-align: center;">
        <h2 style="color: #1976d2; margin-bottom: 15px; font-size: 20px;">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
        <div style="text-align: right; padding: 0 10px;">
          <p style="margin: 8px 0; font-size: 14px;"><strong><i class="fas fa-id-card"></i> Ø§Ù„ÙƒÙˆØ¯:</strong> ${id}</p>
          <p style="margin: 8px 0; font-size: 14px;"><strong><i class="fas fa-user"></i> Ø§Ù„Ø§Ø³Ù…:</strong> ${name}</p>
          <p style="margin: 8px 0; font-size: 14px;"><strong><i class="fas fa-graduation-cap"></i> Ø§Ù„ØµÙ:</strong> ${grade}</p>
        </div>
        <p style="margin-top: 15px; color: #666; font-size: 12px;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©: ${new Date().toLocaleDateString('ar-EG')}</p>
      </div>
    `;
    
    document.body.appendChild(tempDiv);
    
    // Use html2canvas to capture the element
    const canvas = await html2canvas(tempDiv, {
      scale: 1,
      logging: false,
      useCORS: true,
      width: 300,
      height: tempDiv.offsetHeight
    });
    
    document.body.removeChild(tempDiv);
    
    // Convert canvas to image URL
    const imageUrl = canvas.toDataURL('image/png');
    
    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­ Ù…Ø¹ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ§Ù„ØµÙˆØ±Ø©
    const shareUrl = encodeURIComponent(window.location.href);
    
    Swal.fire({
      title: 'ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­',
      html: `
        <div style="text-align: right;">
          <div class="share-image-container">
            <img src="${imageUrl}" class="share-image" alt="Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨">
          </div>
          <p><b><i class="fas fa-id-card"></i> ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨:</b> ${id}</p>
          <p><b><i class="fas fa-user"></i> Ø§Ù„Ø§Ø³Ù…:</b> ${name}</p>
          <p><b><i class="fas fa-graduation-cap"></i> Ø§Ù„ØµÙ:</b> ${grade}</p>
          
          <div class="share-buttons">
            <a href="https://www.facebook.com/sharer/sharer.php?u=${shareUrl}" 
               target="_blank" class="share-btn facebook">
              <i class="fab fa-facebook-f"></i> ÙÙŠØ³Ø¨ÙˆÙƒ
            </a>
            <a href="https://wa.me/?text=${encodeURIComponent(`Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨:\nØ§Ù„ÙƒÙˆØ¯: ${id}\nØ§Ù„Ø§Ø³Ù…: ${name}\nØ§Ù„ØµÙ: ${grade}}`)}" 
               target="_blank" class="share-btn whatsapp">
              <i class="fab fa-whatsapp"></i> ÙˆØ§ØªØ³Ø§Ø¨
            </a>
            <a href="https://t.me/share/url?url=${shareUrl}" 
               target="_blank" class="share-btn telegram">
              <i class="fab fa-telegram-plane"></i> ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
            </a>
            <a href="#" onclick="downloadStudentImage('${id}', '${imageUrl}')" class="share-btn" style="background-color: #4CAF50;">
              <i class="fas fa-download"></i> ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
            </a>
          </div>
        </div>
      `,
      icon: 'success',
      confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹',
      width: '600px'
    });
    
  } catch (error) {
    console.error('Error capturing student UI:', error);
    // Fallback to regular message if image capture fails
    const shareText = `ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯:
Ø§Ù„Ø§Ø³Ù…: ${name}
Ø§Ù„ØµÙ: ${grade}
ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨: ${id}`;
    
    const shareUrl = encodeURIComponent(window.location.href);
    const encodedText = encodeURIComponent(shareText);
    
    Swal.fire({
      title: 'ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­',
      html: `
        <div style="text-align: right;">
          <p><b><i class="fas fa-id-card"></i> ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨:</b> ${id}</p>
          <p><b><i class="fas fa-user"></i> Ø§Ù„Ø§Ø³Ù…:</b> ${name}</p>
          <p><b><i class="fas fa-graduation-cap"></i> Ø§Ù„ØµÙ:</b> ${grade}</p>
          
          <div class="share-buttons">
            <a href="https://www.facebook.com/sharer/sharer.php?u=${shareUrl}&quote=${encodedText}" 
               target="_blank" class="share-btn facebook">
              <i class="fab fa-facebook-f"></i> ÙÙŠØ³Ø¨ÙˆÙƒ
            </a>
            <a href="https://wa.me/?text=${encodedText}" 
               target="_blank" class="share-btn whatsapp">
              <i class="fab fa-whatsapp"></i> ÙˆØ§ØªØ³Ø§Ø¨
            </a>
            <a href="https://t.me/share/url?url=${shareUrl}&text=${encodedText}" 
               target="_blank" class="share-btn telegram">
              <i class="fab fa-telegram-plane"></i> ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
            </a>
          </div>
        </div>
      `,
      icon: 'success',
      confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹',
      width: '600px'
    });
  }
}

function downloadStudentImage(id, imageUrl) {
  const link = document.createElement('a');
  link.href = imageUrl;
  link.download = `Ø·Ø§Ù„Ø¨_${id}.png`;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

function clearAddForm() {
  document.getElementById('newStudentName').value = '';
  document.getElementById('newStudentGrade').value = '';
  document.getElementById('newStudentLevel').value = '';
  document.getElementById('newStudentId').value = generateStudentId();
}

function saveStudent() {
  const id = document.getElementById('studentId').value.trim();
  const name = document.getElementById('studentName').value.trim();
  const grade = document.getElementById('studentGrade').value;
  const level = document.getElementById('studentLevel').value;
  
  if (!id) {
    showError('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨');
    document.getElementById('studentId').focus();
    return;
  }
  
  if (!name) {
    showError('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨');
    document.getElementById('studentName').focus();
    return;
  }
  
  if (!grade) {
    showError('ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ');
    document.getElementById('studentGrade').focus();
    return;
  }
  
  if (currentStudentId === null && students[id]) {
    showError('ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹');
    document.getElementById('studentId').focus();
    return;
  }
  
  if (currentStudentId === null) {
    // Add new student
    students[id] = {
      name,
      main: grade,
      info: level,
      notes: '',
      attendance: Object.fromEntries(weekDays.map(day => [day, "-"])),
      fees: Object.fromEntries(months.map(month => [month, false]))
    };
    
    showSuccess('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
  } else {
    // Update existing student
    if (currentStudentId !== id) {
      // If ID changed, we need to create new entry and delete old one
      students[id] = {
        name,
        main: grade,
        info: level,
        notes: students[currentStudentId].notes || '',
        attendance: {...students[currentStudentId].attendance},
        fees: {...students[currentStudentId].fees}
      };
      delete students[currentStudentId];
    } else {
      // Just update the existing student
      students[id].name = name;
      students[id].main = grade;
      students[id].info = level;
    }
    showSuccess('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
  }
  
  renderTable();
  renderStudentCards();
  closeModal();
}

function copyStudentLink(id) {
  const student = students[id];
  const shareText = `Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨:
Ø§Ù„Ø§Ø³Ù…: ${student.name}
Ø§Ù„ØµÙ: ${student.main}
Ø§Ù„Ù…Ø³ØªÙˆÙ‰: ${student.info || '-'}
ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨: ${id}
${student.notes ? `\nØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${student.notes}` : ''}`;
  
  navigator.clipboard.writeText(shareText).then(() => {
    Swal.fire({
      title: 'ØªÙ… Ø§Ù„Ù†Ø³Ø®!',
      text: 'ØªÙ… Ù†Ø³Ø® Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©',
      icon: 'success',
      timer: 2000
    });
  }).catch(err => {
    showError('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + err);
  });
}

function confirmDelete() {
  if (deleteStudentId) {
    delete students[deleteStudentId];
    renderTable();
    renderStudentCards();
    closeModal();
    showSuccess('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
    deleteStudentId = null;
  }
}

// ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª
function switchTab(tabName) {
  document.querySelectorAll('.tab').forEach(tab => {
    tab.classList.remove('active');
  });
  
  document.querySelectorAll('.tab-content').forEach(content => {
    content.classList.remove('active');
  });
  
  document.querySelector(`.tab[onclick="switchTab('${tabName}')"]`).classList.add('active');
  document.getElementById(`${tabName}-tab`).classList.add('active');
}

function showPostModal(postId = null) {
  currentPostId = postId;
  postImageFile = null;
  
  if (postId) {
    // ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
    document.getElementById('postModalTitle').innerHTML = '<i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ±';
    const post = posts[postId];
    document.getElementById('editPostTitle').value = post.title;
    document.getElementById('editPostContent').value = post.content;
    
    // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
    const preview = document.getElementById('postImagePreview');
    if (post.image) {
      preview.src = post.image;
      preview.style.display = 'block';
    } else {
      preview.style.display = 'none';
    }
  } else {
    // ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
    document.getElementById('postModalTitle').innerHTML = '<i class="fas fa-plus"></i> Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯';
    document.getElementById('editPostTitle').value = '';
    document.getElementById('editPostContent').value = '';
    document.getElementById('postImagePreview').style.display = 'none';
  }
  
  document.getElementById('savePostBtn').onclick = savePost;
  document.getElementById('postModal').style.display = 'block';
}

function previewPostImage() {
  const fileInput = document.getElementById('postImageInput');
  const preview = document.getElementById('postImagePreview');
  
  if (fileInput.files && fileInput.files[0]) {
    postImageFile = fileInput.files[0];
    const reader = new FileReader();
    
    reader.onload = function(e) {
      preview.src = e.target.result;
      preview.style.display = 'block';
    }
    
    reader.readAsDataURL(fileInput.files[0]);
  }
}

function savePost() {
  const title = document.getElementById('editPostTitle').value.trim();
  const content = document.getElementById('editPostContent').value.trim();
  
  if (!title) {
    showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ù„Ù„Ù…Ù†Ø´ÙˆØ±');
    return;
  }
  
  if (!content) {
    showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø­ØªÙˆÙ‰ Ù„Ù„Ù…Ù†Ø´ÙˆØ±');
    return;
  }
  
  const postId = currentPostId || Date.now().toString();
  
  if (!currentPostId) {
    // Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯
    posts[postId] = {
      title,
      content,
      likes: 0,
      likedBy: [],
      shares: 0,
      date: new Date().toLocaleString('ar-EG'),
      author: 'Ø§Ù„Ù…Ø¯ÙŠØ±'
    };
    
    // Handle image upload if exists
    if (postImageFile) {
      const reader = new FileReader();
      reader.onload = function(e) {
        posts[postId].image = e.target.result;
        savePostsToGitHub();
        renderPosts();
        closePostModal();
        showSuccess('ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­');
      };
      reader.readAsDataURL(postImageFile);
    } else {
      savePostsToGitHub();
      renderPosts();
      closePostModal();
      showSuccess('ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­');
    }
  } else {
    // ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†Ø´ÙˆØ± Ù…ÙˆØ¬ÙˆØ¯
    posts[postId].title = title;
    posts[postId].content = content;
    
    // Handle image upload if exists
    if (postImageFile) {
      const reader = new FileReader();
      reader.onload = function(e) {
        posts[postId].image = e.target.result;
        savePostsToGitHub();
        renderPosts();
        closePostModal();
        showSuccess('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­');
      };
      reader.readAsDataURL(postImageFile);
    } else {
      // Only update image if it wasn't removed
      if (!document.getElementById('postImagePreview').style.display === 'none' && posts[postId].image) {
        delete posts[postId].image;
      }
      savePostsToGitHub();
      renderPosts();
      closePostModal();
      showSuccess('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­');
    }
  }
}

function deletePost(postId) {
  Swal.fire({
    title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
    text: 'Ø³ÙŠØªÙ… Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†Ø´ÙˆØ± ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#d33',
    cancelButtonColor: '#3085d6',
    confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù',
    cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
  }).then((result) => {
    if (result.isConfirmed) {
      delete posts[postId];
      savePostsToGitHub();
      renderPosts();
      showSuccess('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­');
    }
  });
}

function toggleLike(postId) {
  const post = posts[postId];
  const user = 'admin'; // ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ù‡Ø°Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙƒ Ù†Ø¸Ø§Ù… Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
  
  if (!post.likedBy) {
    post.likedBy = [];
  }
  
  if (post.likedBy.includes(user)) {
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨
    post.likes--;
    post.likedBy = post.likedBy.filter(u => u !== user);
  } else {
    // Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ø¬Ø§Ø¨
    post.likes = (post.likes || 0) + 1;
    post.likedBy.push(user);
  }
  
  savePostsToGitHub();
  renderPosts();
}

function sharePost(postId) {
  const post = posts[postId];
  let shareText = `${post.title}\n\n${post.content}\n\nØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±: ${post.date}`;
  const shareUrl = encodeURIComponent(window.location.href);
  const encodedText = encodeURIComponent(shareText);
  
  // Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª
  post.shares = (post.shares || 0) + 1;
  savePostsToGitHub();
  renderPosts();
  
  // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
  let shareHtml = `
    <div style="text-align: right;">
      <p>Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©:</p>
      <div class="share-buttons">
        <a href="https://www.facebook.com/sharer/sharer.php?u=${shareUrl}&quote=${encodedText}" 
           target="_blank" class="share-btn facebook">
          <i class="fab fa-facebook-f"></i> ÙÙŠØ³Ø¨ÙˆÙƒ
        </a>
        <a href="https://wa.me/?text=${encodedText}" 
           target="_blank" class="share-btn whatsapp">
          <i class="fab fa-whatsapp"></i> ÙˆØ§ØªØ³Ø§Ø¨
        </a>
        <a href="https://t.me/share/url?url=${shareUrl}&text=${encodedText}" 
           target="_blank" class="share-btn telegram">
          <i class="fab fa-telegram-plane"></i> ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
        </a>
  `;
  
  // Ø¥Ø¶Ø§ÙØ© Ø²Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ù†Ø´ÙˆØ± ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ØµÙˆØ±Ø©
  if (post.image) {
    shareHtml += `
        <a href="#" onclick="downloadPostImage('${postId}')" class="share-btn" style="background-color: #4CAF50;">
          <i class="fas fa-download"></i> ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
        </a>
    `;
  }
  
  shareHtml += `
      </div>
    </div>
  `;
  
  Swal.fire({
    title: 'Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ù†Ø´ÙˆØ±',
    html: shareHtml,
    showConfirmButton: false,
    width: '600px'
  });
}

function downloadPostImage(postId) {
  const post = posts[postId];
  if (post.image) {
    const link = document.createElement('a');
    link.href = post.image;
    link.download = `Ù…Ù†Ø´ÙˆØ±_${postId}.png`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }
}

function copyPostLink(postId) {
  const post = posts[postId];
  const shareText = `${post.title}\n\n${post.content}\n\nØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±: ${post.date}`;
  
  navigator.clipboard.writeText(shareText).then(() => {
    Swal.fire({
      title: 'ØªÙ… Ø§Ù„Ù†Ø³Ø®!',
      text: 'ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©',
      icon: 'success',
      timer: 2000
    });
  }).catch(err => {
    showError('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ù…Ù†Ø´ÙˆØ±: ' + err);
  });
}

async function savePostsToGitHub() {
  const token = document.getElementById('token').value.trim();
  if (!token) {
    showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ØªÙˆÙƒÙ† GitHub Ø£ÙˆÙ„Ø§Ù‹');
    document.getElementById('token').focus();
    return;
  }

  const content = JSON.stringify(posts, null, 2);
  const utf8Content = unescape(encodeURIComponent(content));
  const encoded = btoa(utf8Content);

  try {
    showLoading(true);
    
    // ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ù„Ù Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§ Ø¨Ø§Ù„ÙØ¹Ù„ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ SHA
    let sha = '';
    try {
      const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${postsPath}`, {
        headers: {
          'Authorization': `token ${token}`
        }
      });
      
      if (res.ok) {
        const data = await res.json();
        sha = data.sha;
      }
    } catch (error) {
      console.log('Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ØŒ Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯');
    }
    
    const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${postsPath}`, {
      method: 'PUT',
      headers: {
        'Authorization': `token ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        message: "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…",
        content: encoded,
        sha: sha || undefined,
        branch: branch
      })
    });

    if (res.ok) {
      const data = await res.json();
      showSuccess('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ Ø¹Ù„Ù‰ GitHub');
    } else {
      const error = await res.json();
      showError(`ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª! ${error.message}`);
    }
  } catch (error) {
    showError(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`);
  } finally {
    showLoading(false);
  }
}

async function saveToGitHub() {
  const token = document.getElementById('token').value.trim();
  if (!token) {
    showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ØªÙˆÙƒÙ† GitHub Ø£ÙˆÙ„Ø§Ù‹');
    document.getElementById('token').focus();
    return;
  }
  localStorage.setItem("gh_token", token);

  // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨
  const content = JSON.stringify(students, null, 2);
  const utf8Content = unescape(encodeURIComponent(content));
  const encoded = btoa(utf8Content);

  try {
    showLoading(true);
    const saveBtn = document.querySelector('button[onclick="saveToGitHub()"]');
    originalButtonText = saveBtn.innerHTML;
    saveBtn.innerHTML = '<span class="spinner"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
    saveBtn.disabled = true;
    
    const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
      method: 'PUT',
      headers: {
        'Authorization': `token ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        message: "ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…",
        content: encoded,
        sha: sha,
        branch: branch
      })
    });

    if (res.ok) {
      const data = await res.json();
      sha = data.content.sha;
      showSuccess('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ Ø¹Ù„Ù‰ GitHub');
      loadStudents();
    } else {
      const error = await res.json();
      showError(`ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­ÙØ¸! ${error.message}`);
    }
  } catch (error) {
    showError(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`);
  } finally {
    showLoading(false);
    const saveBtn = document.querySelector('button[onclick="saveToGitHub()"]');
    if (saveBtn) {
      saveBtn.innerHTML = originalButtonText;
      saveBtn.disabled = false;
    }
  }
}

function showLoading(show) {
  isLoading = show;
  const loader = document.createElement('div');
  loader.id = 'loadingOverlay';
  loader.style.position = 'fixed';
  loader.style.top = '0';
  loader.style.left = '0';
  loader.style.width = '100%';
  loader.style.height = '100%';
  loader.style.backgroundColor = 'rgba(0,0,0,0.5)';
  loader.style.display = 'flex';
  loader.style.justifyContent = 'center';
  loader.style.alignItems = 'center';
  loader.style.zIndex = '9998';
  loader.innerHTML = `
    <div style="background: var(--white); padding: 30px; border-radius: 12px; text-align: center; box-shadow: var(--shadow);">
      <div class="spinner" style="width: 40px; height: 40px; margin: 0 auto 15px; border-top-color: var(--primary-color);"></div>
      <p style="font-weight: bold; color: var(--text-color);">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
    </div>
  `;
  
  if (show) {
    document.body.appendChild(loader);
  } else {
    const existingLoader = document.getElementById('loadingOverlay');
    if (existingLoader) {
      existingLoader.remove();
    }
  }
}

function showError(message) {
  Swal.fire({
    title: 'âŒ Ø®Ø·Ø£',
    text: message,
    icon: 'error',
    confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
  });
}

function showSuccess(message) {
  Swal.fire({
    title: 'âœ… ØªÙ… Ø¨Ù†Ø¬Ø§Ø­',
    text: message,
    icon: 'success',
    confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
  });
}

// Export data functions
function exportData(format) {
  if (Object.keys(students).length === 0) {
    showError('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§');
    return;
  }

  switch(format) {
    case 'pdf':
      exportToPDF();
      break;
    case 'excel':
      exportToExcel();
      break;
    case 'word':
      exportToWord();
      break;
    case 'json':
      exportToJSON();
      break;
    default:
      showError('ØµÙŠØºØ© Ø§Ù„ØªØµØ¯ÙŠØ± ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©');
  }
}

function exportToPDF() {
  const doc = new jsPDF();
  
  // Add title
  doc.setFont('Tajawal', 'normal');
  doc.setTextColor(33, 150, 243);
  doc.setFontSize(22);
  doc.text('ØªÙ‚Ø±ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨', 105, 15, null, null, 'center');
  
  // Add date
  doc.setFontSize(12);
  doc.setTextColor(100, 100, 100);
  doc.text(`ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØµØ¯ÙŠØ±: ${new Date().toLocaleDateString('ar-EG')}`, 105, 25, null, null, 'center');
  
  let y = 35;
  
  // Add each student's data
  Object.keys(students).forEach((id, index) => {
    const student = students[id];
    
    // Start new page if needed
    if (y > 250) {
      doc.addPage();
      y = 20;
    }
    
    // Student header
    doc.setFontSize(14);
    doc.setTextColor(0, 0, 0);
    doc.text(`Ø§Ù„Ø·Ø§Ù„Ø¨ ${index + 1}: ${student.name} (${id})`, 14, y);
    y += 10;
    
    // Basic info
    doc.setFontSize(12);
    doc.text(`Ø§Ù„ØµÙ: ${student.main}`, 14, y);
    doc.text(`Ø§Ù„Ù…Ø³ØªÙˆÙ‰: ${student.info || '-'}`, 100, y);
    y += 8;
    
    // Notes
    if (student.notes) {
      doc.text('Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:', 14, y);
      y += 8;
      doc.text(student.notes, 14, y, { maxWidth: 180 });
      y += 10;
    }
    
    // Attendance
    doc.text('Ø§Ù„Ø­Ø¶ÙˆØ±:', 14, y);
    y += 8;
    
    let attendanceText = weekDays.map(day => {
      return `${day}: ${student.attendance?.[day] || '-'}`;
    }).join('ØŒ ');
    
    doc.text(attendanceText, 14, y, { maxWidth: 180 });
    y += 10;
    
    // Fees
    doc.text('Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª:', 14, y);
    y += 8;
    
    let feesText = months.map(month => {
      return `${month}: ${student.fees?.[month] ? 'Ù…Ø³Ø¯Ø¯Ø©' : 'ØºÙŠØ± Ù…Ø³Ø¯Ø¯Ø©'}`;
    }).join('ØŒ ');
    
    doc.text(feesText, 14, y, { maxWidth: 180 });
    y += 15;
    
    // Add separator
    doc.setDrawColor(200, 200, 200);
    doc.line(14, y, 196, y);
    y += 5;
  });
  
  // Save the PDF
  doc.save('Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ø·Ù„Ø§Ø¨.pdf');
}

function exportToExcel() {
  // Prepare data
  const data = [];
  
  // Add headers
  data.push([
    'ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨', 'Ø§Ù„Ø§Ø³Ù…', 'Ø§Ù„ØµÙ', 'Ø§Ù„Ù…Ø³ØªÙˆÙ‰', 'Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª',
    ...weekDays.map(d => `Ø­Ø¶ÙˆØ± ${d}`),
    ...months.map(m => `Ù…ØµØ±ÙˆÙØ§Øª ${m}`)
  ]);
  
  // Add students data
  Object.keys(students).forEach(id => {
    const student = students[id];
    const row = [
      id,
      student.name,
      student.main,
      student.info || '-',
      student.notes || '-',
      ...weekDays.map(day => student.attendance?.[day] || '-'),
      ...months.map(month => student.fees?.[month] ? 'Ù…Ø³Ø¯Ø¯Ø©' : 'ØºÙŠØ± Ù…Ø³Ø¯Ø¯Ø©')
    ];
    data.push(row);
  });
  
  // Create worksheet
  const ws = XLSX.utils.aoa_to_sheet(data);
  
  // Create workbook
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨");
  
  // Export to Excel
  XLSX.writeFile(wb, "Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ø·Ù„Ø§Ø¨.xlsx");
}

function exportToWord() {
  // Create HTML content
  let html = `
    <!DOCTYPE html>
    <html dir="rtl">
    <head>
      <meta charset="UTF-8">
      <title>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</title>
      <style>
        body { font-family: 'Tajawal', sans-serif; }
        h1 { color: #1976d2; text-align: center; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #1976d2; color: white; }
        .notes { background-color: #f5f5f5; padding: 10px; border-radius: 5px; margin: 10px 0; }
      </style>
    </head>
    <body>
      <h1>ØªÙ‚Ø±ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</h1>
      <p style="text-align: center;">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØµØ¯ÙŠØ±: ${new Date().toLocaleDateString('ar-EG')}</p>
  `;
  
  // Add students data
  let count = 1;
  Object.keys(students).forEach(id => {
    const student = students[id];
    html += `
      <div style="page-break-inside: avoid;">
        <h3>Ø§Ù„Ø·Ø§Ù„Ø¨ ${count++}: ${student.name} (${id})</h3>
        <table>
          <tr>
            <th>Ø§Ù„ØµÙ</th>
            <th>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th>
          </tr>
          <tr>
            <td>${student.main}</td>
            <td>${student.info || '-'}</td>
          </tr>
        </table>
        ${student.notes ? `<div class="notes"><strong>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ${student.notes}</div>` : ''}
        <hr>
      </div>
    `;
  });
  
  html += `
    </body>
    </html>
  `;
  
  // Create Blob and download
  const blob = new Blob([html], { type: 'application/msword' });
  saveAs(blob, 'Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ø·Ù„Ø§Ø¨.doc');
}

function exportToJSON() {
  const dataStr = JSON.stringify(students, null, 2);
  const blob = new Blob([dataStr], { type: 'application/json' });
  saveAs(blob, 'Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ø·Ù„Ø§Ø¨.json');
}

// Initialize when page loads
window.onload = function() {
  // Check if already logged in
  if (localStorage.getItem('isLoggedIn') === 'true') {
    document.getElementById('loginScreen').style.display = 'none';
    loadStudents();
    loadPosts();
    fillGradeSelects();
  }
  
  // Focus on password field if not logged in
  if (document.getElementById('loginScreen').style.display !== 'none') {
    document.getElementById('loginPassword').focus();
  }
  
  // Set up event listeners
  document.getElementById('savePostBtn').onclick = savePost;
  
  // Generate initial student ID for add form
  document.getElementById('newStudentId').value = generateStudentId();
  
  // Handle window resize for responsive display
  window.addEventListener('resize', function() {
    if (window.innerWidth <= 768) {
      renderStudentCards();
    } else {
      renderTable();
    }
  });
};
</script>
</body>
</html>
